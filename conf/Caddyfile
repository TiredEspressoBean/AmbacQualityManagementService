# Main site
govtracker.ambac.local {
    tls /etc/caddy/certs/govtracker.crt /etc/caddy/certs/govtracker.key


    encode gzip
    
    # Handle API routes first - most specific to least specific
    handle /auth/* {
        reverse_proxy backend:8000
    }
    
    handle /api/* {
        reverse_proxy backend:8000
    }
    
    handle /accounts/* {
        reverse_proxy backend:8000
    }
    
    handle /admin/* {
        reverse_proxy backend:8000
    }
    
    handle /media/* {
        reverse_proxy backend:8000
    }
    
    handle /static/* {
        reverse_proxy backend:8000
    }
    
    # Handle SPA routes (fallback)
    handle {
        root * /usr/share/caddy
        try_files {path} /index.html
        file_server
    }
}

