# PDF Export Requirements - Auto/Aero QMS

**Last Updated:** January 2026

This document tracks all PDF documents that the QMS software should generate for automotive (IATF 16949, Volvo SPQAM) and aerospace (AS9100D) compliance.

**Scope:** Software-generated PDFs only. Documents created externally (CAD drawings, FMEAs in Excel, etc.) are stored via the document management system but not generated by this software.

---

## Legend

| Status | Meaning |
|--------|---------|
| ‚úÖ Ready | Data exists, template ready, can generate now |
| üî∂ Data Ready | Data exists in system, needs PDF template |
| ‚ùå Gap | Requires new data model or feature before PDF can be generated |

---

## Tier 1: Critical - Required for Every Shipment/Submission

These PDFs are requested by customers for nearly every order or quality event.

| # | Document | Industry | Data Source | Status | Effort |
|---|----------|----------|-------------|--------|--------|
| 1 | **Certificate of Conformance (C of C)** | Both | Part + Order + QualityReports (inspection summary) | üî∂ Data Ready | 3-4 days |
| 2 | **8D Report** | Both | CAPA + RcaRecord (FiveWhys/Fishbone) + CapaTasks + CapaVerification | üî∂ Data Ready | 2-3 days |
| 3 | **Dimensional Results / FAI Form 3** | Both | MeasurementDefinition + MeasurementResult | üî∂ Data Ready | 2-3 days |
| 4 | **Part Traveler / History Report** | Both | Part + StepTransitionLog + QualityReports + operator attribution | üî∂ Data Ready | 2-3 days |
| 5 | **NCR Report** | Both | QuarantineDisposition + QualityReports + resolution notes | üî∂ Data Ready | 1-2 days |

**Total Tier 1 Effort: ~2 weeks**

---

## Tier 2: High Priority - Required for Part Approval

These PDFs are required for PPAP submissions (automotive) and FAI packages (aerospace).

| # | Document | Industry | Data Source | Status | Effort |
|---|----------|----------|-------------|--------|--------|
| 6 | **FAI Form 1 (Part Number Accountability)** | Aero | Part Type + Part + revision + approval data | üî∂ Data Ready | 2-3 days |
| 7 | **FAI Form 2 (Product Accountability)** | Aero | Process Steps + (material data - partial) | üî∂ Partial | 2-3 days |
| 8 | **PSW (Part Submission Warrant)** | Auto | Part Type + PPAP checklist status + signatures | ‚ùå Gap (need PPAP tracking) | 2-3 days |
| 9 | **CAPA Report** | Both | CAPA + all related data (full detail report) | üî∂ Data Ready | 2-3 days |
| 10 | **Inspection Report (Generic)** | Both | QualityReports + MeasurementResults (formatted) | üî∂ Data Ready | 1-2 days |

**Total Tier 2 Effort: ~2 weeks**

---

## PPAP (Production Part Approval Process) - 18 Element Breakdown

PPAP is an automotive industry standard (AIAG) consisting of 18 elements. This section maps each element to system capabilities and PDF generation readiness.

**Current Coverage: ~50% (4 complete, 7 partial, 5 missing, 2 N/A)**

### ‚úÖ Complete Elements (4) - Data exists, PDF can be generated

| # | Element | Data Source | PDF Status | Notes |
|---|---------|-------------|------------|-------|
| 1 | **Design Records** | Documents (versioned, approved) | üî∂ Data Ready | Drawing package export |
| 5 | **Process Flow Diagram** | Process ‚Üí Steps (sequence) | üî∂ Data Ready | Visual flow chart |
| 9 | **Dimensional Results** | MeasurementDefinition + MeasurementResult | üî∂ Data Ready | FAI Form 3 format |
| 11 | **Initial Process Studies (Cpk/Ppk)** | SPCBaseline + SPC calculations | ‚úÖ Ready | SPC print page exists |

### üî∂ Partial Elements (7) - Document storage only, no structured workflow

| # | Element | Current State | PDF Status | Gap |
|---|---------|---------------|------------|-----|
| 2 | **Engineering Change Docs** | Document revisions exist | üî∂ Data Ready | No formal ECN workflow |
| 4 | **Design FMEA** | Can upload FMEA docs | üî∂ Storage | No RPN tracking/structured form |
| 6 | **Process FMEA** | Can upload FMEA docs | üî∂ Storage | No RPN tracking/structured form |
| 7 | **Control Plan** | Can upload docs | üî∂ Storage | No structured control plan model |
| 10 | **Material/Performance Test Results** | QualityReports exist | üî∂ Partial | No material cert linking |
| 12 | **Qualified Lab Documentation** | Can upload docs | üî∂ Storage | Document export only |
| 16 | **Checking Aids** | Equipment model exists | üî∂ Partial | No calibration tracking |

### ‚ùå Missing Elements (5) - Requires new features

| # | Element | Gap | Effort | PDF Blocked Until |
|---|---------|-----|--------|-------------------|
| 3 | **Customer Engineering Approval** | No customer approval tracking | 1-2 weeks | Approval workflow extension |
| 8 | **MSA/Gage R&R** | No study workflow or calculations | 2-3 weeks | MSA module |
| 13 | **Appearance Approval Report (AAR)** | No structured AAR form | 1 week | AAR model |
| 17 | **Customer-Specific Requirements** | No structured tracking | 1 week | Requirements model |
| 18 | **Part Submission Warrant (PSW)** | No PSW generation or tracker | 2-3 weeks | PPAP submission model |

### N/A Elements (2) - Physical, not software-generated

| # | Element | Notes |
|---|---------|-------|
| 14 | **Sample Production Parts** | Physical samples, system tracks which parts were sampled |
| 15 | **Master Sample** | Physical retention, system tracks location/status |

### PPAP PDF Generation Priority

**Phase 1 - Immediate (data exists):**
1. Dimensional Results (Element 9) ‚Üí FAI Form 3 format
2. Initial Process Studies (Element 11) ‚Üí SPC report ‚úÖ Done
3. Process Flow Diagram (Element 5) ‚Üí Visual export
4. Design Records package (Element 1) ‚Üí Document bundle

**Phase 2 - After model enhancements:**
5. PSW (Element 18) ‚Üí Requires PPAPSubmission model
6. Control Plan (Element 7) ‚Üí Requires ControlPlan model
7. MSA/Gage R&R (Element 8) ‚Üí Requires MSA module

**Minimum Viable PPAP Package:**
- PSW (cover sheet)
- Dimensional Results
- Process Flow Diagram
- SPC/Cpk data
- Design Records
- Document bundle (FMEAs, Control Plans as uploaded docs)

**Estimated effort for minimum viable PPAP:** 7-8 weeks (model + PDF work)

---

## Tier 3: Medium Priority - Process Documentation

These PDFs support process documentation and change management.

| # | Document | Industry | Data Source | Status | Effort |
|---|----------|----------|-------------|--------|--------|
| 11 | **Process Flow Diagram** | Auto | Process ‚Üí Steps (sequence, routing) | üî∂ Data Ready | 2-3 days |
| 12 | **Deviation Request** | Both | QuarantineDisposition (USE_AS_IS) + approval | üî∂ Data Ready | 2-3 days |
| 13 | **Control Plan** | Auto | Control plan data model | ‚ùå Gap (need Control Plan model) | 4-5 days |
| 14 | **Quality Metrics Report** | Both | Aggregated QualityReports (FPY, scrap rate, etc.) | üî∂ Needs calculations | 3-4 days |

**Total Tier 3 Effort: ~2 weeks**

---

## Tier 4: Requires New Modules

These PDFs depend on features that need to be built first.

| # | Document | Industry | Depends On | Status | Notes |
|---|----------|----------|------------|--------|-------|
| 15 | **SPC Control Charts** | Auto | SPC module | ‚úÖ Ready | X-bar/R, I-MR charts, Cpk/Ppk, Western Electric rules |
| 16 | **MSA/Gage R&R Report** | Auto | MSA module | ‚ùå Gap | Measurement capability studies |
| 17 | **Calibration Certificate** | Both | Calibration module | ‚ùå Gap | Equipment cal records |
| 18 | **Calibration Due Report** | Both | Calibration module | ‚ùå Gap | Equipment needing calibration |
| 19 | **Training Record** | Both | Training module | ‚ùå Gap | Individual training history |
| 20 | **Competency Matrix** | Both | Training module | ‚ùå Gap | Who's qualified for what |
| 21 | **Supplier Scorecard** | Both | Supplier module | ‚ùå Gap | Supplier performance metrics |
| 22 | **Receiving Inspection Report** | Both | Supplier module | ‚ùå Gap | Incoming inspection data |
| 23 | **Audit Report** | Both | Audit module | ‚ùå Gap | Audit findings and results |
| 24 | **SCAR (Supplier Corrective Action)** | Both | Supplier module + CAPA | ‚ùå Gap | Supplier quality issues |

---

## PDF Generation Implementation Details

### ‚úÖ Implemented Technology Stack (December 2025)

The PDF generation system has been implemented using **Playwright** for server-side headless browser rendering. This approach renders actual React UI pages as PDFs, ensuring pixel-perfect output that matches what users see.

- **PDF Library:** Playwright (headless Chromium browser to PDF)
- **Template Engine:** React frontend (print-optimized routes)
- **Storage:** `GeneratedReport` model ‚Üí linked to `Documents` (DMS integration)
- **API:** `/api/reports/generate/` - Generic endpoint for all report types
- **Processing:** Celery async task with email delivery

### Architecture Flow

```
User clicks "Email Report"
        ‚Üì
Frontend POST /api/reports/generate/
        ‚Üì
Django returns "Report is being generated"
        ‚Üì
Celery worker picks up task
        ‚Üì
Playwright opens /spc/print?processId=1&stepId=2&measurementId=3
        ‚Üì
Renders React page ‚Üí PDF (Letter format, 0.5in margins)
        ‚Üì
Saves PDF to Documents model (DMS integration)
        ‚Üì
Emails PDF to user
        ‚Üì
Stores GeneratedReport record for audit trail
```

### Key Files

| File | Purpose |
|------|---------|
| `Tracker/services/pdf_generator.py` | Generic Playwright PDF generation service |
| `Tracker/viewsets/reports.py` | Report API endpoints (generate, history, types) |
| `Tracker/models/qms.py` | GeneratedReport model for audit trail |
| `Tracker/tasks.py` | Celery task `generate_and_email_report` |
| `frontend/src/hooks/useReportEmail.ts` | Reusable hook for any page |
| `frontend/src/components/print-layout.tsx` | Shared print wrapper component |
| `frontend/src/pages/SpcPrintPage.tsx` | Print-optimized SPC view |

### How To: Add a New PDF Report (Step-by-Step)

Adding a new PDF report requires changes in 4 places: backend config, frontend print page, frontend route, and a button to trigger it.

---

#### Step 1: Add Report Config (Backend)

Edit `Tracker/services/pdf_generator.py` and add your report to `REPORT_CONFIG`:

```python
# In PdfGenerator class
REPORT_CONFIG = {
    "spc": {...},  # existing

    # Add your new report
    "certificate_of_conformance": {
        "route": "/orders/{order_id}/coc/print",  # Frontend print route
        "wait_selector": "[data-print-ready]",    # Element that signals page is ready
        "title": "Certificate of Conformance",    # PDF metadata title
        "timeout": 15000,                          # Max wait time in ms
        "filename_template": "COC_{order_id}_{timestamp}.pdf"  # Optional
    },
}
```

**Config options:**
| Field | Required | Description |
|-------|----------|-------------|
| `route` | Yes | Frontend route with `{param}` placeholders |
| `wait_selector` | Yes | CSS selector to wait for before rendering |
| `title` | Yes | PDF document title |
| `timeout` | No | Max wait time (default: 30000ms) |
| `filename_template` | No | Custom filename pattern |

---

#### Step 2: Create Print Page Component (Frontend)

Create a new file: `src/pages/CocPrintPage.tsx`

```tsx
import { useSearchParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { PrintLayout } from "@/components/print-layout";
import { api } from "@/lib/api";

export default function CocPrintPage() {
    const [searchParams] = useSearchParams();
    const orderId = searchParams.get("order_id");

    // Fetch data needed for the report
    const { data: order, isLoading } = useQuery({
        queryKey: ["order", orderId],
        queryFn: () => api.orders.retrieve(Number(orderId)),
        enabled: !!orderId,
    });

    const { data: parts } = useQuery({
        queryKey: ["order-parts", orderId],
        queryFn: () => api.parts.list({ order: Number(orderId) }),
        enabled: !!orderId,
    });

    if (isLoading || !order) {
        return <div>Loading...</div>;
    }

    return (
        // PrintLayout handles page sizing, margins, headers
        <PrintLayout title="Certificate of Conformance">
            {/* This attribute signals Playwright the page is ready */}
            <div data-print-ready>
                {/* Report header */}
                <div className="text-center mb-6">
                    <h1 className="text-2xl font-bold">Certificate of Conformance</h1>
                    <p className="text-muted-foreground">Order: {order.order_number}</p>
                </div>

                {/* Report content */}
                <table className="w-full border-collapse">
                    <thead>
                        <tr className="border-b">
                            <th className="text-left p-2">Part Number</th>
                            <th className="text-left p-2">Serial Number</th>
                            <th className="text-left p-2">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {parts?.results?.map((part) => (
                            <tr key={part.id} className="border-b">
                                <td className="p-2">{part.part_type_name}</td>
                                <td className="p-2">{part.serial_number}</td>
                                <td className="p-2">{part.status}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>

                {/* Signature block */}
                <div className="mt-8 pt-4 border-t">
                    <p>I certify that the parts listed above conform to all applicable requirements.</p>
                    <div className="mt-4 flex gap-8">
                        <div>
                            <div className="w-48 border-b border-black"></div>
                            <p className="text-sm">Authorized Signature</p>
                        </div>
                        <div>
                            <div className="w-32 border-b border-black"></div>
                            <p className="text-sm">Date</p>
                        </div>
                    </div>
                </div>
            </div>
        </PrintLayout>
    );
}
```

**Key requirements:**
- Must include `data-print-ready` attribute on an element (Playwright waits for this)
- Use `PrintLayout` wrapper for consistent styling
- Fetch all data needed - page must be self-contained
- Use print-friendly CSS (no interactive elements)

---

#### Step 3: Add Route (Frontend)

Edit `src/router.tsx`:

```tsx
import CocPrintPage from "@/pages/CocPrintPage";

// Add to your routes array
{
    path: "/orders/:orderId/coc/print",
    element: <CocPrintPage />,
},
```

---

#### Step 4: Add "Email Report" Button (Frontend)

Use the `useReportEmail` hook on the page where users trigger the report:

```tsx
import { useReportEmail } from "@/hooks/useReportEmail";
import { Button } from "@/components/ui/button";
import { Mail } from "lucide-react";

function OrderDetailsPage({ orderId }: { orderId: number }) {
    const { mutate: emailReport, isPending } = useReportEmail();

    const handleEmailReport = () => {
        emailReport({
            report_type: "certificate_of_conformance",  // Must match REPORT_CONFIG key
            parameters: { order_id: orderId },          // Passed to route as query params
        });
    };

    return (
        <Button onClick={handleEmailReport} disabled={isPending}>
            <Mail className="w-4 h-4 mr-2" />
            {isPending ? "Generating..." : "Email C of C"}
        </Button>
    );
}
```

---

#### Step 5: Test the Report

1. **Test print page directly:** Navigate to `/orders/123/coc/print?order_id=123` in browser
2. **Check rendering:** Verify all data loads and `data-print-ready` element appears
3. **Test PDF generation:** Click "Email Report" button, check email
4. **Verify audit trail:** Check `GeneratedReport` records in admin

---

#### Troubleshooting

| Issue | Cause | Solution |
|-------|-------|----------|
| PDF is blank | `data-print-ready` never appears | Check data loading, add error boundaries |
| PDF times out | Slow queries or missing data | Increase timeout, optimize queries |
| Missing styles | CSS not print-friendly | Use `@media print` rules, avoid `screen`-only styles |
| Auth errors | Playwright can't authenticate | Check service account token in pdf_generator.py |
| Wrong data | Parameters not passed | Verify `parameters` object matches route params |

---

#### Print-Friendly CSS Tips

```css
/* In your print page or global styles */
@media print {
    /* Hide non-essential elements */
    .no-print { display: none !important; }

    /* Ensure backgrounds print */
    * { -webkit-print-color-adjust: exact !important; }

    /* Page breaks */
    .page-break { page-break-before: always; }
    .no-break { page-break-inside: avoid; }

    /* Table headers repeat on each page */
    thead { display: table-header-group; }
}

/* PrintLayout handles these via @page rules */
@page {
    size: letter;
    margin: 0.5in;
}
```

---

### Common PDF Elements

All generated PDFs include:

1. **Header:** Document title, generation timestamp
2. **Metadata Block:** Report-specific parameters
3. **Content:** Full React page rendered in print mode
4. **Footer:** Page numbers (via CSS `@page` rules)

### Data Model: GeneratedReport

```python
class GeneratedReport(SecureModel):
    """Audit trail for generated PDF reports. Links to DMS for storage."""

    class ReportStatus(models.TextChoices):
        PENDING = 'pending', 'Pending'
        GENERATING = 'generating', 'Generating'
        COMPLETED = 'completed', 'Completed'
        FAILED = 'failed', 'Failed'

    report_type = models.CharField(max_length=50)  # spc, capa, quality_report
    generated_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)
    generated_at = models.DateTimeField(auto_now_add=True)
    parameters = models.JSONField(default=dict)  # Query params for reproducibility

    # Link to DMS instead of storing files directly
    document = models.ForeignKey('Documents', on_delete=models.SET_NULL, null=True, blank=True)

    # Email delivery tracking
    emailed_to = models.EmailField(null=True, blank=True)
    emailed_at = models.DateTimeField(null=True, blank=True)

    # Status tracking
    status = models.CharField(max_length=20, choices=ReportStatus.choices, default=ReportStatus.PENDING)
    error_message = models.TextField(null=True, blank=True)
```

---

## Document-Specific Requirements

### 1. Certificate of Conformance (C of C)

**Purpose:** Certifies shipped parts meet customer specifications

**Required Content:**
- Part number, revision, serial numbers (list)
- Customer PO number, order reference
- Inspection summary (pass/fail counts, key measurements)
- Material certifications (reference or "see attached")
- Statement of conformance
- Authorized signature(s) from approval workflow

**Data Sources:**
- `Part` (serial numbers, part type)
- `CustomerOrder` (PO number, customer)
- `QualityReports` (inspection results summary)
- `ApprovalRequest/ApprovalResponse` (signatures)

---

### 2. 8D Report

**Purpose:** Formal problem-solving documentation for customer quality issues

**Required Content:**
- D1: Team members (assigned_to, CapaTaskAssignees)
- D2: Problem description (problem_statement)
- D3: Interim containment actions (immediate_action + CONTAINMENT tasks)
- D4: Root cause analysis (FiveWhys or Fishbone from RcaRecord)
- D5: Permanent corrective actions (CORRECTIVE tasks)
- D6: Implementation verification (task completion + verification dates)
- D7: Preventive actions (PREVENTIVE tasks)
- D8: Team recognition (optional field - not currently tracked)

**Data Sources:**
- `CAPA` (header info, problem statement, immediate_action)
- `RcaRecord` + `FiveWhys` or `Fishbone` (root cause)
- `CapaTask` (grouped by task_type: CONTAINMENT, CORRECTIVE, PREVENTIVE)
- `CapaVerification` (effectiveness verification)
- `ApprovalRequest/ApprovalResponse` (approval signatures)

---

### 3. FAI Form 3 / Dimensional Results

**Purpose:** Document inspection measurements for first article or PPAP

**Required Content:**
- Part number, serial number, revision
- Characteristic table:
  | Char # | Reference | Requirement | Nominal | Tol+ | Tol- | Actual | Pass/Fail |
- Total characteristics, total pass, total fail
- Inspector signature, date

**Data Sources:**
- `MeasurementDefinition` (characteristic name, nominal, tolerance, unit)
- `MeasurementResult` (actual_value, pass/fail status)
- `QualityReports` (inspector/operator, date)

**Enhancement Needed:**
- Add `characteristic_number` (balloon #) to `MeasurementDefinition`
- Add `drawing_reference` (zone/location) to `MeasurementDefinition`

---

### 4. Part Traveler / History

**Purpose:** Complete manufacturing history for a single part

**Required Content:**
- Part header (serial number, part type, work order)
- Step-by-step history:
  | Step | Started | Completed | Operator | Duration | Status |
- Inspection results per step
- Any NCRs/dispositions
- Current status

**Data Sources:**
- `Part` (serial number, status, part_type)
- `StepTransitionLog` (step, operator, timestamps)
- `QualityReports` (inspection results per step)
- `QuarantineDisposition` (if any NCRs)

---

### 5. PSW (Part Submission Warrant) - PPAP Element 18

**Purpose:** Cover sheet for PPAP submission package. Required for every PPAP submission.

**AIAG Standard Format - Required Sections:**

1. **Part Information**
   - Part name, part number, customer part number
   - Engineering change level, drawing number/date
   - Additional engineering changes (if any)
   - Safety/regulated item designation (Y/N)

2. **Organization Information**
   - Supplier name, code, address
   - Customer name/division
   - Buyer/engineer contact

3. **Submission Information**
   - Submission reason: Initial, Engineering Change, Tooling Transfer, Correction, Other
   - PPAP submission level (1-5)
   - Requested submission date

4. **18-Element Checklist**
   | # | Element | Submitted | N/A | Remarks |
   |---|---------|-----------|-----|---------|
   | 1 | Design Records | ‚òê | ‚òê | |
   | 2 | Engineering Change Documents | ‚òê | ‚òê | |
   | ... | ... | ... | ... | ... |
   | 18 | Part Submission Warrant | ‚òê | ‚òê | |

5. **Declaration**
   - Statement of conformance
   - Authorized signature, title, date, phone

6. **Customer Use Only**
   - Disposition: Approved / Interim Approval / Rejected
   - Customer signature, date
   - Tracking number

**Submission Levels (AIAG):**

| Level | What Customer Receives |
|-------|----------------------|
| 1 | PSW + limited supporting data |
| 2 | PSW + product samples + limited data |
| 3 | PSW + product samples + complete data (default) |
| 4 | PSW + other as defined by customer |
| 5 | PSW + product samples + complete data at supplier site |

**Data Model Required - `PPAPSubmission`:**

```python
class PPAPSubmission(SecureModel):
    """Tracks PPAP submissions to customers."""

    class SubmissionReason(models.TextChoices):
        INITIAL = 'initial', 'Initial Submission'
        ENGINEERING_CHANGE = 'engineering_change', 'Engineering Change'
        TOOLING_TRANSFER = 'tooling_transfer', 'Tooling Transfer/Replacement'
        CORRECTION = 'correction', 'Correction of Discrepancy'
        OTHER = 'other', 'Other'

    class SubmissionLevel(models.IntegerChoices):
        LEVEL_1 = 1, 'Level 1 - PSW only'
        LEVEL_2 = 2, 'Level 2 - PSW + samples + limited data'
        LEVEL_3 = 3, 'Level 3 - PSW + samples + complete data'
        LEVEL_4 = 4, 'Level 4 - Customer defined'
        LEVEL_5 = 5, 'Level 5 - Complete review at supplier'

    class CustomerDecision(models.TextChoices):
        PENDING = 'pending', 'Pending Review'
        APPROVED = 'approved', 'Approved'
        INTERIM = 'interim', 'Interim Approval'
        REJECTED = 'rejected', 'Rejected'

    # Part reference
    part_type = models.ForeignKey(PartType, on_delete=models.CASCADE)

    # Submission details
    submission_reason = models.CharField(max_length=30, choices=SubmissionReason.choices)
    submission_level = models.IntegerField(choices=SubmissionLevel.choices, default=3)
    engineering_change_level = models.CharField(max_length=50, blank=True)
    is_safety_item = models.BooleanField(default=False)

    # 18-element checklist (JSON: {element_num: {submitted: bool, na: bool, remarks: str}})
    element_checklist = models.JSONField(default=dict)

    # Customer info
    customer = models.ForeignKey(Companies, on_delete=models.CASCADE)
    customer_contact = models.CharField(max_length=100, blank=True)

    # Approval
    submitted_at = models.DateTimeField(null=True, blank=True)
    submitted_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)
    customer_decision = models.CharField(max_length=20, choices=CustomerDecision.choices, default='pending')
    customer_decision_date = models.DateTimeField(null=True, blank=True)
    customer_notes = models.TextField(blank=True)

    # Link to generated PSW document
    psw_document = models.ForeignKey(Documents, on_delete=models.SET_NULL, null=True, blank=True)
```

**Gap:** Requires PPAPSubmission model + UI for checklist management + PDF template

**Effort:** 2-3 weeks (model + API + UI + PDF)

---

### 6. FAI Form 1 (Part Number Accountability)

**Purpose:** Header/summary page for AS9102 First Article Inspection

**Required Content:**
- Part information (number, name, revision)
- Design drawing number and revision
- Organization info (name, approval)
- FAI reason (new, design change, process change, other)
- Approval signatures

**Data Sources:**
- `Part` and `PartType` (part info)
- `Documents` (design drawing reference)
- `ApprovalRequest/ApprovalResponse` (signatures)

**Enhancement Needed:**
- Add FAI-specific fields to track reason for FAI

---

### 7. FAI Form 2 (Product Accountability)

**Purpose:** Material and special process documentation

**Required Content:**
- Material information:
  | Material | Specification | Supplier | Lot/Batch |
- Special processes:
  | Process | Specification | Supplier | Approval |
- Functional test results

**Data Sources:**
- Material data: ‚ùå **Gap** - need material lot tracking
- Process data: `Process` and `Step` models (partial)
- Test results: `Documents` (can link test reports)

**Gap:** Requires material/lot tracking module for full compliance

---

## Implementation Roadmap

### ‚úÖ Phase 0: PDF Infrastructure (COMPLETED - December 2025)
1. Set up Playwright + React print routes infrastructure
2. Create `GeneratedReport` model with DMS integration
3. Implement generic report generation API
4. Build SPC print page with X-bar/R, I-MR charts, Cpk/Ppk, Western Electric rules
5. Add "Email Report" button to SPC page
6. Configure Celery task for async PDF generation and email delivery

### Phase 1: Tier 1 Documents (~2 weeks)
1. Create print routes for each document type:
   - Certificate of Conformance (`/coc/{orderId}/print`)
   - 8D Report (`/quality/capas/{id}/print`) - Route configured, needs print page
   - Dimensional Results (`/quality/reports/{id}/print`) - Route configured, needs print page
   - Part Traveler (`/parts/{id}/traveler/print`)
   - NCR Report (`/quality/dispositions/{id}/print`)

### Phase 2: Tier 2 Documents + PPAP Foundation (~3 weeks)
1. FAI Form 1 (AS9102)
2. FAI Form 3 / Dimensional Results (PPAP Element 9)
3. FAI Form 2 (partial - manual fields for materials)
4. CAPA Report (route configured in PdfGenerator)
5. Process Flow Diagram (PPAP Element 5)

### Phase 3: PPAP Module (~4-5 weeks)
**Model Development:**
1. Create `PPAPSubmission` model with 18-element checklist
2. API endpoints for submission CRUD and status tracking
3. Customer approval workflow integration

**PDF Templates:**
4. PSW (Part Submission Warrant) - PPAP Element 18
5. PPAP Package Cover Sheet (index of all elements)
6. Element Summary Report (checklist status for all 18)

**UI:**
7. PPAP submission management page
8. Element checklist editor
9. Customer decision tracking

### Phase 4: PPAP Enhancements (~3-4 weeks)
1. Control Plan model + PDF (PPAP Element 7)
2. MSA/Gage R&R module + PDF (PPAP Element 8)
3. Customer Engineering Approval tracking (PPAP Element 3)
4. Appearance Approval Report (PPAP Element 13)

### Phase 5: Tier 3 + Remaining Documents
1. Quality Metrics Report
2. Deviation Request

### Phase 6: Module-Dependent PDFs
Build dependent modules, then add PDF generation:
- ‚úÖ SPC module ‚Üí Control charts, capability reports (COMPLETED)
- Calibration module ‚Üí Cal certificates, due lists
- Training module ‚Üí Training records, competency matrix
- Supplier module ‚Üí Scorecards, SCAR, receiving reports

---

## Volvo SPQAM Specific Requirements

For Volvo customers, additional PDF formatting may be required:

| Document | Volvo-Specific Requirement |
|----------|---------------------------|
| 8D Report | Must follow Volvo 8D template format |
| PPAP/PSW | Must support Volvo 3-phase PPAP tracking |
| Deviation Request | Must reference Volvo deviation process |

---

## Summary

| Priority | Count | Status | Total Effort |
|----------|-------|--------|--------------|
| **Infrastructure** | - | ‚úÖ Complete | Done |
| **Tier 1** | 5 | üî∂ Data Ready | ~2 weeks |
| **Tier 2** | 5 | üî∂ Mostly Ready | ~2 weeks |
| **PPAP Module** | 18 elements | 4 ‚úÖ, 7 üî∂, 5 ‚ùå | ~7-8 weeks |
| **Tier 3** | 4 | üî∂/‚ùå Mixed | ~2 weeks |
| **Tier 4** | 10 | 1 Ready, 9 Gap | Depends on module builds |

**Completed (December 2025):**
- ‚úÖ PDF generation infrastructure (Playwright + Celery + Email)
- ‚úÖ SPC Control Charts (X-bar/R, I-MR, Cpk/Ppk, Western Electric rules) - PPAP Element 11
- ‚úÖ Generic report API (`/api/reports/generate/`)
- ‚úÖ DMS integration (GeneratedReport ‚Üí Documents)
- ‚úÖ Report history endpoint (`/api/reports/history/`)

**PPAP Status (18 Elements):**
- ‚úÖ **4 Complete:** Design Records, Process Flow, Dimensional Results, Initial Process Studies (Cpk)
- üî∂ **7 Partial:** Engineering Change, FMEA (D/P), Control Plan, Test Results, Lab Docs, Checking Aids
- ‚ùå **5 Missing:** Customer Engineering Approval, MSA/Gage R&R, AAR, Customer Requirements, PSW
- N/A **2 Physical:** Sample Parts, Master Sample

**Total Effort Estimate:**
- Tier 1-3 PDFs: ~6 weeks
- Minimum viable PPAP: ~7-8 weeks additional
- Full PPAP (all elements): ~12-14 weeks total

**Key Dependencies:**
1. **PPAPSubmission Model** - Required for PSW generation and submission tracking
2. **MSA Module** - Required for Gage R&R studies (PPAP Element 8)
3. **Control Plan Model** - Required for structured control plans (PPAP Element 7)
4. **Material Tracking** - Required for complete FAI Form 2 (PPAP Element 10)
5. **Characteristic Numbering** - Enhancement to MeasurementDefinition for FAI Form 3

---

## References

- AS9102 Rev C (First Article Inspection)
- AIAG PPAP Manual 4th Edition
- Volvo SPQAM 6th Edition (2022)
- IATF 16949:2016 (Automotive QMS)
