# Generated by Django 5.1.6 on 2026-02-09 21:02

import Tracker.models.core
import Tracker.models.qms
import django.contrib.auth.models
import django.contrib.auth.validators
import django.db.models.deletion
import django.utils.timezone
import pgvector.django.vector
import uuid_utils.compat
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
        ('contenttypes', '0002_remove_content_type_name'),
    ]

    operations = [
        # Enable pgvector extension before any tables use vector type
        migrations.RunSQL(
            'CREATE EXTENSION IF NOT EXISTS vector;',
            reverse_sql='DROP EXTENSION IF EXISTS vector;'
        ),
        migrations.CreateModel(
            name='Tenant',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Display name of the organization', max_length=100)),
                ('slug', models.SlugField(help_text='URL-safe identifier, immutable after creation', unique=True)),
                ('tier', models.CharField(choices=[('starter', 'Starter'), ('pro', 'Pro'), ('enterprise', 'Enterprise')], default='starter', max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('trial', 'Trial'), ('suspended', 'Suspended'), ('pending_deletion', 'Pending Deletion')], default='active', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('is_demo', models.BooleanField(default=False, help_text='Demo tenant with reset capability')),
                ('status_changed_at', models.DateTimeField(blank=True, null=True)),
                ('trial_ends_at', models.DateTimeField(blank=True, help_text='Trial expiration date', null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('settings', models.JSONField(blank=True, default=dict, help_text='Tenant-specific configuration')),
            ],
            options={
                'verbose_name': 'Tenant',
                'verbose_name_plural': 'Tenants',
                'ordering': ['name'],
                'permissions': [('full_tenant_access', 'Has full visibility to all tenant data (without this, users only see data related to their orders)')],
            },
        ),
        migrations.CreateModel(
            name='ApprovalRequest',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('approval_number', models.CharField(max_length=20)),
                ('object_id', models.CharField(blank=True, max_length=36, null=True)),
                ('approval_type', models.CharField(choices=[('DOCUMENT_RELEASE', 'Document Release'), ('CAPA_CRITICAL', 'CAPA Critical'), ('CAPA_MAJOR', 'CAPA Major'), ('ECO', 'Engineering Change Order'), ('TRAINING_CERT', 'Training Certification'), ('PROCESS_APPROVAL', 'Process Approval')], max_length=50)),
                ('status', models.CharField(choices=[('NOT_REQUIRED', 'Not Required'), ('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=20)),
                ('requested_at', models.DateTimeField(auto_now_add=True)),
                ('flow_type', models.CharField(choices=[('ALL_REQUIRED', 'All Required'), ('THRESHOLD', 'Threshold'), ('ANY', 'Any')], default='ALL_REQUIRED', max_length=20)),
                ('sequence_type', models.CharField(choices=[('PARALLEL', 'Parallel'), ('SEQUENTIAL', 'Sequential')], default='PARALLEL', max_length=20)),
                ('threshold', models.IntegerField(blank=True, null=True)),
                ('delegation_policy', models.CharField(choices=[('OPTIONAL', 'Optional'), ('DISABLED', 'Disabled')], default='DISABLED', max_length=20)),
                ('escalation_day', models.DateField(blank=True, help_text='Specific date when escalation should trigger', null=True)),
                ('due_date', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('reason', models.TextField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.approvalrequest')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Approval Request',
                'verbose_name_plural': 'Approval Requests',
                'ordering': ['-requested_at'],
                'permissions': [('respond_to_approval', 'Can respond to approval requests')],
            },
        ),
        migrations.CreateModel(
            name='ApprovalTemplate',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('template_name', models.CharField(max_length=100)),
                ('approval_type', models.CharField(choices=[('DOCUMENT_RELEASE', 'Document Release'), ('CAPA_CRITICAL', 'CAPA Critical'), ('CAPA_MAJOR', 'CAPA Major'), ('ECO', 'Engineering Change Order'), ('TRAINING_CERT', 'Training Certification'), ('PROCESS_APPROVAL', 'Process Approval')], max_length=50)),
                ('default_threshold', models.IntegerField(blank=True, null=True)),
                ('auto_assign_by_role', models.CharField(blank=True, help_text="Group name to auto-assign (e.g., 'QA_Manager')", max_length=50, null=True)),
                ('approval_flow_type', models.CharField(choices=[('ALL_REQUIRED', 'All Required'), ('THRESHOLD', 'Threshold'), ('ANY', 'Any')], default='ALL_REQUIRED', max_length=20)),
                ('delegation_policy', models.CharField(choices=[('OPTIONAL', 'Optional'), ('DISABLED', 'Disabled')], default='DISABLED', max_length=20)),
                ('approval_sequence', models.CharField(choices=[('PARALLEL', 'Parallel'), ('SEQUENTIAL', 'Sequential')], default='PARALLEL', max_length=20)),
                ('allow_self_approval', models.BooleanField(default=False, help_text='Allow requesters to approve their own requests (requires justification)')),
                ('default_due_days', models.IntegerField(default=5, help_text='Days until due date')),
                ('escalation_days', models.IntegerField(blank=True, help_text='Days before escalation triggers', null=True)),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='Null = currently active', null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.approvaltemplate')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Approval Template',
                'verbose_name_plural': 'Approval Templates',
                'ordering': ['template_name'],
                'permissions': [('create_approval_template', 'Can create approval templates'), ('manage_approval_workflow', 'Can manage approval workflows')],
            },
        ),
        migrations.CreateModel(
            name='BOM',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('revision', models.CharField(max_length=10)),
                ('bom_type', models.CharField(choices=[('assembly', 'Assembly'), ('disassembly', 'Disassembly')], default='assembly', max_length=20)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('released', 'Released'), ('obsolete', 'Obsolete')], default='draft', max_length=20)),
                ('description', models.TextField(blank=True)),
                ('effective_date', models.DateField(blank=True, null=True)),
                ('obsolete_date', models.DateField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.bom')),
            ],
            options={
                'verbose_name': 'Bill of Materials',
                'verbose_name_plural': 'Bills of Materials',
                'ordering': ['part_type', '-revision'],
            },
        ),
        migrations.CreateModel(
            name='Companies',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=50)),
                ('description', models.TextField()),
                ('hubspot_api_id', models.CharField(blank=True, max_length=50, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.companies')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Company',
                'verbose_name_plural': 'Companies',
            },
        ),
        migrations.CreateModel(
            name='Core',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('core_number', models.CharField(help_text='Unique identifier for this core unit (unique per tenant)', max_length=100)),
                ('serial_number', models.CharField(blank=True, help_text='Original equipment serial number if available', max_length=100)),
                ('received_date', models.DateField()),
                ('source_type', models.CharField(choices=[('customer_return', 'Customer Return'), ('purchased', 'Purchased Core'), ('warranty', 'Warranty Return'), ('trade_in', 'Trade-In')], default='customer_return', max_length=20)),
                ('source_reference', models.CharField(blank=True, help_text='RMA number, PO number, or other reference', max_length=100)),
                ('condition_grade', models.CharField(choices=[('A', 'Grade A - Excellent'), ('B', 'Grade B - Good'), ('C', 'Grade C - Fair'), ('SCRAP', 'Scrap - Not Usable')], help_text='Overall condition grade assigned at receipt', max_length=10)),
                ('condition_notes', models.TextField(blank=True, help_text='Detailed notes on condition observed at receipt')),
                ('status', models.CharField(choices=[('received', 'Received'), ('in_disassembly', 'In Disassembly'), ('disassembled', 'Disassembled'), ('scrapped', 'Scrapped')], default='received', max_length=20)),
                ('disassembly_started_at', models.DateTimeField(blank=True, null=True)),
                ('disassembly_completed_at', models.DateTimeField(blank=True, null=True)),
                ('core_credit_value', models.DecimalField(blank=True, decimal_places=2, help_text='Credit value to be issued for this core', max_digits=10, null=True)),
                ('core_credit_issued', models.BooleanField(default=False, help_text='Whether core credit has been issued to customer')),
                ('core_credit_issued_at', models.DateTimeField(blank=True, null=True)),
                ('customer', models.ForeignKey(blank=True, help_text='Customer who returned this core', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='returned_cores', to='Tracker.companies')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.core')),
            ],
            options={
                'verbose_name': 'Core',
                'verbose_name_plural': 'Cores',
                'ordering': ['-received_date'],
            },
        ),
        migrations.CreateModel(
            name='DocumentType',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(help_text="Display name (e.g., 'Standard Operating Procedure')", max_length=100)),
                ('code', models.CharField(help_text="Short code for ID prefix (e.g., 'SOP', 'WI', 'DWG')", max_length=20)),
                ('description', models.TextField(blank=True, help_text='Description of this document type')),
                ('requires_approval', models.BooleanField(default=True, help_text='Whether documents of this type require approval before release')),
                ('default_review_period_days', models.PositiveIntegerField(blank=True, help_text='Default number of days between reviews for documents of this type (e.g., 365 for annual review)', null=True)),
                ('default_retention_days', models.PositiveIntegerField(blank=True, help_text='Default retention period in days for documents of this type (e.g., 2555 for 7 years)', null=True)),
                ('approval_template', models.ForeignKey(blank=True, help_text='Approval template to use for this document type (defaults to DOCUMENT_RELEASE if not set)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='document_types', to='Tracker.approvaltemplate')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.documenttype')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Document Type',
                'verbose_name_plural': 'Document Types',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Documents',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('classification', models.CharField(choices=[('public', 'Public'), ('internal', 'Internal Use'), ('confidential', 'Confidential'), ('restricted', 'Restricted'), ('secret', 'Secret')], default='internal', help_text='Security classification level for document access control', max_length=20, null=True)),
                ('itar_controlled', models.BooleanField(default=False, help_text='Document contains ITAR-controlled technical data (22 CFR 120-130)')),
                ('eccn', models.CharField(blank=True, help_text='Export Control Classification Number (e.g., EAR99, 3A001, 9A004.a)', max_length=20)),
                ('export_control_reason', models.CharField(blank=True, help_text="Reason for export control classification (e.g., 'Contains defense article specs')", max_length=100)),
                ('ai_readable', models.BooleanField(default=False)),
                ('is_image', models.BooleanField(default=False)),
                ('file_name', models.CharField(max_length=50)),
                ('file', models.FileField(upload_to=Tracker.models.core.part_doc_upload_path)),
                ('upload_date', models.DateField(auto_now_add=True)),
                ('object_id', models.CharField(blank=True, help_text='ID of the object this document relates to (CharField for UUID compatibility)', max_length=36, null=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('UNDER_REVIEW', 'Under Review'), ('APPROVED', 'Approved'), ('RELEASED', 'Released'), ('OBSOLETE', 'Obsolete')], default='DRAFT', help_text='Document workflow status', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('change_justification', models.TextField(blank=True, help_text='Reason for this revision (required when creating new versions)')),
                ('effective_date', models.DateField(blank=True, help_text='Date when this document version becomes effective (typically set on release)', null=True)),
                ('review_date', models.DateField(blank=True, help_text='Next scheduled review date (auto-calculated from document_type.default_review_period_days)', null=True)),
                ('obsolete_date', models.DateField(blank=True, help_text='Date when document was marked obsolete (set automatically on status change)', null=True)),
                ('retention_until', models.DateField(blank=True, help_text='Date until which this document must be retained (calculated from effective_date + retention_days)', null=True)),
                ('content_type', models.ForeignKey(blank=True, help_text='Model of the object this document relates to', null=True, on_delete=django.db.models.deletion.SET_NULL, to='contenttypes.contenttype')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.documents')),
                ('document_type', models.ForeignKey(blank=True, help_text='Type/category of document (e.g., SOP, Work Instruction)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents', to='Tracker.documenttype')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Document',
                'verbose_name_plural': 'Documents',
                'permissions': [('view_confidential_documents', 'Can view confidential classification documents'), ('view_restricted_documents', 'Can view restricted classification documents'), ('view_secret_documents', 'Can view secret classification documents'), ('classify_documents', 'Can change document classification level')],
            },
        ),
        migrations.CreateModel(
            name='EquipmentType',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=50)),
                ('description', models.TextField(blank=True)),
                ('requires_calibration', models.BooleanField(default=False)),
                ('default_calibration_interval_days', models.PositiveIntegerField(blank=True, help_text='Default calibration interval in days for new equipment of this type', null=True)),
                ('is_portable', models.BooleanField(default=False)),
                ('track_downtime', models.BooleanField(default=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.equipmenttype')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Equipment Type',
                'verbose_name_plural': 'Equipment Types',
            },
        ),
        migrations.CreateModel(
            name='Equipments',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=100)),
                ('serial_number', models.CharField(blank=True, max_length=100)),
                ('status', models.CharField(choices=[('in_service', 'In Service'), ('out_of_service', 'Out of Service'), ('in_calibration', 'In Calibration'), ('in_maintenance', 'In Maintenance'), ('retired', 'Retired')], default='in_service', max_length=20)),
                ('location', models.CharField(blank=True, max_length=100)),
                ('calibration_interval_days', models.PositiveIntegerField(blank=True, help_text='Calibration interval in days. Overrides equipment type default if set.', null=True)),
                ('_requires_calibration_override', models.BooleanField(blank=True, db_column='requires_calibration_override', help_text="Override equipment type's requires_calibration setting. Null = inherit from type.", null=True)),
                ('manufacturer', models.CharField(blank=True, max_length=100)),
                ('model_number', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.equipments')),
                ('equipment_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.equipmenttype')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Equipment',
                'verbose_name_plural': 'Equipments',
            },
        ),
        migrations.CreateModel(
            name='ExternalAPIOrderIdentifier',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('stage_name', models.CharField(max_length=100)),
                ('API_id', models.CharField(max_length=50)),
                ('pipeline_id', models.CharField(blank=True, max_length=50, null=True)),
                ('display_order', models.IntegerField(default=0)),
                ('last_synced_at', models.DateTimeField(blank=True, null=True)),
                ('include_in_progress', models.BooleanField(default=False)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.externalapiorderidentifier')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'External API Order Identifier',
                'verbose_name_plural': 'External API Order Identifiers',
                'ordering': ['pipeline_id', 'display_order'],
            },
        ),
        migrations.CreateModel(
            name='HubSpotSyncLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sync_type', models.CharField(choices=[('full', 'Full Sync'), ('incremental', 'Incremental Sync'), ('single', 'Single Deal Sync')], default='full', max_length=20)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('running', 'Running'), ('success', 'Success'), ('failed', 'Failed')], default='running', max_length=20)),
                ('deals_processed', models.IntegerField(default=0)),
                ('deals_created', models.IntegerField(default=0)),
                ('deals_updated', models.IntegerField(default=0)),
                ('error_message', models.TextField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'HubSpot Sync Log',
                'verbose_name_plural': 'HubSpot Sync Logs',
                'ordering': ['-started_at'],
                'indexes': [models.Index(fields=['-started_at'], name='Tracker_hub_started_c0fd3d_idx'), models.Index(fields=['status'], name='Tracker_hub_status_40c38d_idx')],
            },
        ),
        migrations.CreateModel(
            name='MeasurementDefinition',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('label', models.CharField(max_length=100)),
                ('type', models.CharField(choices=[('NUMERIC', 'Numeric'), ('PASS_FAIL', 'Pass/Fail')], max_length=20)),
                ('unit', models.CharField(blank=True, max_length=50)),
                ('nominal', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('upper_tol', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('lower_tol', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('required', models.BooleanField(default=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.measurementdefinition')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Orders',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('order_number', models.CharField(blank=True, help_text='Auto-generated internal order number: ORD-YYYY-####', max_length=20)),
                ('name', models.CharField(max_length=200)),
                ('customer_note', models.TextField(blank=True, null=True)),
                ('estimated_completion', models.DateField(blank=True, null=True)),
                ('original_completion_date', models.DateTimeField(blank=True, null=True)),
                ('order_status', models.CharField(choices=[('RFI', 'RFI'), ('PENDING', 'Pending'), ('IN_PROGRESS', 'In progress'), ('COMPLETED', 'Completed'), ('ON_HOLD', 'On hold'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=50)),
                ('hubspot_deal_id', models.CharField(blank=True, db_index=True, max_length=60, null=True)),
                ('last_synced_hubspot_stage', models.CharField(blank=True, max_length=100, null=True)),
                ('hubspot_last_synced_at', models.DateTimeField(blank=True, null=True)),
                ('company', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='orders', to='Tracker.companies')),
                ('current_hubspot_gate', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.externalapiorderidentifier')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.orders')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Order',
            },
        ),
        migrations.CreateModel(
            name='PartTypes',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=50)),
                ('ID_prefix', models.CharField(blank=True, max_length=50, null=True)),
                ('ERP_id', models.CharField(blank=True, max_length=50, null=True)),
                ('itar_controlled', models.BooleanField(default=False, help_text='Part type is ITAR-controlled defense article (22 CFR 121 USML)')),
                ('eccn', models.CharField(blank=True, help_text='Default ECCN for parts of this type (e.g., EAR99, 9A004)', max_length=20)),
                ('usml_category', models.CharField(blank=True, help_text='USML Category if ITAR-controlled (e.g., IV, XI, XIX)', max_length=10)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.parttypes')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Part Type',
                'verbose_name_plural': 'Part Types',
            },
        ),
        migrations.CreateModel(
            name='Parts',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('ERP_id', models.CharField(max_length=50)),
                ('part_status', models.CharField(choices=[('PENDING', 'Pending'), ('IN_PROGRESS', 'In Progress'), ('AWAITING_QA', 'Awaiting QA'), ('READY FOR NEXT STEP', 'Ready for next step'), ('COMPLETED', 'Completed'), ('QUARANTINED', 'Quarantined'), ('REWORK_NEEDED', 'Rework Needed'), ('REWORK_IN_PROGRESS', 'Rework In Progress'), ('SCRAPPED', 'Scrapped'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=50)),
                ('requires_sampling', models.BooleanField(default=False)),
                ('sampling_context', models.JSONField(blank=True, default=dict)),
                ('total_rework_count', models.IntegerField(default=0)),
                ('itar_controlled', models.BooleanField(default=False, help_text='Part is ITAR-controlled defense article (22 CFR 121)')),
                ('eccn', models.CharField(blank=True, help_text='Export Control Classification Number (e.g., EAR99, 9A004)', max_length=20)),
                ('export_license_required', models.BooleanField(default=False, help_text='Whether export license is required for this specific part')),
                ('country_of_origin', models.CharField(blank=True, help_text='ISO 3166-1 alpha-3 country code for country of origin', max_length=3)),
                ('order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='parts', to='Tracker.orders')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.parts')),
                ('part_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='parts', to='Tracker.parttypes')),
            ],
            options={
                'verbose_name': 'Part',
                'verbose_name_plural': 'Parts',
            },
        ),
        migrations.CreateModel(
            name='MaterialLot',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('lot_number', models.CharField(max_length=100)),
                ('material_description', models.CharField(blank=True, help_text='Description for raw materials not tracked as PartTypes', max_length=200)),
                ('supplier_lot_number', models.CharField(blank=True, help_text="Supplier's lot/batch number", max_length=100)),
                ('received_date', models.DateField()),
                ('quantity', models.DecimalField(decimal_places=4, max_digits=12)),
                ('quantity_remaining', models.DecimalField(decimal_places=4, max_digits=12)),
                ('unit_of_measure', models.CharField(max_length=20)),
                ('status', models.CharField(choices=[('received', 'Received'), ('in_use', 'In Use'), ('consumed', 'Consumed'), ('scrapped', 'Scrapped'), ('quarantine', 'Quarantine')], default='received', max_length=20)),
                ('manufacture_date', models.DateField(blank=True, null=True)),
                ('expiration_date', models.DateField(blank=True, null=True)),
                ('certificate_of_conformance', models.FileField(blank=True, null=True, upload_to='lot_certificates/')),
                ('storage_location', models.CharField(blank=True, max_length=100)),
                ('parent_lot', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='child_lots', to='Tracker.materiallot')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.materiallot')),
                ('supplier', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='supplied_lots', to='Tracker.companies')),
                ('material_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='material_lots', to='Tracker.parttypes')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Material Lot',
                'verbose_name_plural': 'Material Lots',
                'ordering': ['-received_date'],
            },
        ),
        migrations.CreateModel(
            name='HarvestedComponent',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('disassembled_at', models.DateTimeField(auto_now_add=True)),
                ('condition_grade', models.CharField(choices=[('A', 'Grade A - Excellent'), ('B', 'Grade B - Good'), ('C', 'Grade C - Fair'), ('SCRAP', 'Scrap - Not Usable')], max_length=10)),
                ('condition_notes', models.TextField(blank=True)),
                ('is_scrapped', models.BooleanField(default=False)),
                ('scrap_reason', models.CharField(blank=True, max_length=200)),
                ('scrapped_at', models.DateTimeField(blank=True, null=True)),
                ('position', models.CharField(blank=True, help_text="Position within core (e.g., 'Cyl 1', 'Position A')", max_length=50)),
                ('original_part_number', models.CharField(blank=True, help_text='Original part number if readable', max_length=100)),
                ('core', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='harvested_components', to='Tracker.core')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.harvestedcomponent')),
                ('component_part', models.OneToOneField(blank=True, help_text='The Parts record created for this component (if accepted)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='harvested_from', to='Tracker.parts')),
                ('component_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='harvested_as', to='Tracker.parttypes')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Harvested Component',
                'verbose_name_plural': 'Harvested Components',
                'ordering': ['-disassembled_at'],
            },
        ),
        migrations.AddField(
            model_name='core',
            name='core_type',
            field=models.ForeignKey(help_text='Type of unit (e.g., Fuel Injector, Turbocharger)', on_delete=django.db.models.deletion.PROTECT, related_name='cores', to='Tracker.parttypes'),
        ),
        migrations.CreateModel(
            name='BOMLine',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('quantity', models.DecimalField(decimal_places=4, max_digits=10)),
                ('unit_of_measure', models.CharField(default='EA', max_length=20)),
                ('find_number', models.CharField(blank=True, help_text='Drawing callout number', max_length=20)),
                ('reference_designator', models.CharField(blank=True, help_text="Reference designator(s) - e.g., 'R1, R2, R3' for electronics", max_length=100)),
                ('is_optional', models.BooleanField(default=False)),
                ('allow_harvested', models.BooleanField(default=True, help_text='For reman: whether harvested components can satisfy this line')),
                ('notes', models.TextField(blank=True)),
                ('line_number', models.PositiveIntegerField(default=0)),
                ('bom', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='Tracker.bom')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.bomline')),
                ('component_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='used_in_boms', to='Tracker.parttypes')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'BOM Line',
                'verbose_name_plural': 'BOM Lines',
                'ordering': ['bom', 'line_number'],
            },
        ),
        migrations.AddField(
            model_name='bom',
            name='part_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='boms', to='Tracker.parttypes'),
        ),
        migrations.CreateModel(
            name='Processes',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=50)),
                ('is_remanufactured', models.BooleanField(default=False)),
                ('is_batch_process', models.BooleanField(default=False, help_text='If True, UI treats work order parts as a batch unit')),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending_approval', 'Pending Approval'), ('approved', 'Approved'), ('deprecated', 'Deprecated')], default='draft', help_text='Controls editability and availability for work orders', max_length=20)),
                ('change_description', models.TextField(blank=True, help_text='Description of changes from previous version (for approval review)', null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('part_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='processes', to='Tracker.parttypes')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.processes')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Process',
                'verbose_name_plural': 'Processes',
            },
        ),
        migrations.CreateModel(
            name='QualityErrorsList',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('error_name', models.CharField(max_length=50)),
                ('error_example', models.TextField()),
                ('requires_3d_annotation', models.BooleanField(default=False)),
                ('part_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.parttypes')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.qualityerrorslist')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='QualityReportDefect',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('count', models.PositiveIntegerField(default=1, help_text='Number of this defect type found')),
                ('location', models.CharField(blank=True, help_text="Location on part (e.g., 'Near bore #3', 'Left edge')", max_length=100)),
                ('severity', models.CharField(choices=[('minor', 'Minor'), ('major', 'Major'), ('critical', 'Critical')], default='major', help_text='Severity of this specific defect instance', max_length=20)),
                ('notes', models.TextField(blank=True, help_text='Additional details about this defect')),
                ('error_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='report_instances', to='Tracker.qualityerrorslist')),
            ],
            options={
                'ordering': ['-severity', 'error_type__error_name'],
            },
        ),
        migrations.CreateModel(
            name='QualityReports',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('report_number', models.CharField(blank=True, help_text='Auto-generated: QR-YYYY-######', max_length=20)),
                ('sampling_method', models.CharField(default='manual', max_length=50)),
                ('status', models.CharField(choices=[('PASS', 'Pass'), ('FAIL', 'Fail'), ('PENDING', 'Pending')], max_length=10)),
                ('description', models.TextField(blank=True, max_length=300, null=True)),
                ('errors', models.ManyToManyField(blank=True, related_name='quality_reports', through='Tracker.QualityReportDefect', to='Tracker.qualityerrorslist')),
                ('file', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.documents')),
                ('machine', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.equipments')),
                ('part', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='error_reports', to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.qualityreports')),
            ],
            options={
                'verbose_name': 'Error Report',
                'verbose_name_plural': 'Error Reports',
                'permissions': [('approve_qualityreports', 'Can approve quality reports'), ('approve_own_qualityreports', 'Can approve own quality reports')],
            },
        ),
        migrations.AddField(
            model_name='qualityreportdefect',
            name='report',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='defects', to='Tracker.qualityreports'),
        ),
        migrations.CreateModel(
            name='QuarantineDisposition',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('disposition_number', models.CharField(editable=False, max_length=20)),
                ('current_state', models.CharField(choices=[('OPEN', 'Open'), ('IN_PROGRESS', 'In Progress'), ('CLOSED', 'Closed')], default='OPEN', max_length=15)),
                ('disposition_type', models.CharField(blank=True, choices=[('REWORK', 'Rework'), ('REPAIR', 'Repair'), ('SCRAP', 'Scrap'), ('USE_AS_IS', 'Use As Is'), ('RETURN_TO_SUPPLIER', 'Return to Supplier')], max_length=20)),
                ('severity', models.CharField(choices=[('CRITICAL', 'Critical'), ('MAJOR', 'Major'), ('MINOR', 'Minor')], default='MAJOR', max_length=10)),
                ('description', models.TextField(blank=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('containment_action', models.TextField(blank=True, help_text='Immediate action taken to prevent escape')),
                ('containment_completed_at', models.DateTimeField(blank=True, null=True)),
                ('requires_customer_approval', models.BooleanField(default=False)),
                ('customer_approval_received', models.BooleanField(default=False)),
                ('customer_approval_reference', models.CharField(blank=True, help_text='PO#, email reference, or approval document number', max_length=100)),
                ('customer_approval_date', models.DateField(blank=True, null=True)),
                ('scrap_verified', models.BooleanField(default=False)),
                ('scrap_verification_method', models.CharField(blank=True, help_text='How product was rendered unusable: crushed, marked, etc.', max_length=100)),
                ('scrap_verified_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_completed', models.BooleanField(default=False)),
                ('resolution_completed_at', models.DateTimeField(blank=True, null=True)),
                ('rework_attempt_at_step', models.IntegerField(default=1)),
                ('part', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.quarantinedisposition')),
                ('quality_reports', models.ManyToManyField(related_name='dispositions', to='Tracker.qualityreports')),
            ],
            options={
                'verbose_name': 'Disposition',
                'verbose_name_plural': 'Dispositions',
                'ordering': ['-created_at'],
                'permissions': [('approve_disposition', 'Can approve disposition decisions'), ('close_disposition', 'Can close dispositions')],
            },
        ),
        migrations.CreateModel(
            name='CAPA',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('capa_number', models.CharField(help_text='Auto-generated: CAPA-{type}-{year}-{seq}', max_length=30)),
                ('capa_type', models.CharField(choices=[('CORRECTIVE', 'Corrective Action'), ('PREVENTIVE', 'Preventive Action'), ('CUSTOMER_COMPLAINT', 'Customer Complaint'), ('INTERNAL_AUDIT', 'Internal Audit'), ('SUPPLIER', 'Supplier Issue')], max_length=30)),
                ('severity', models.CharField(choices=[('CRITICAL', 'Critical'), ('MAJOR', 'Major'), ('MINOR', 'Minor')], max_length=20)),
                ('status', models.CharField(choices=[('OPEN', 'Open'), ('IN_PROGRESS', 'In Progress'), ('PENDING_VERIFICATION', 'Pending Verification'), ('CLOSED', 'Closed'), ('CANCELLED', 'Cancelled')], default='OPEN', max_length=30)),
                ('problem_statement', models.TextField(help_text='Clear description of the problem')),
                ('immediate_action', models.TextField(blank=True, help_text='Containment action taken immediately', null=True)),
                ('initiated_date', models.DateField(auto_now_add=True)),
                ('due_date', models.DateField(blank=True, help_text='User-set due date', null=True)),
                ('completed_date', models.DateField(blank=True, null=True)),
                ('approval_required', models.BooleanField(default=False, help_text='Whether this CAPA requires management approval (auto-set for Critical/Major)')),
                ('approval_status', models.CharField(choices=[('NOT_REQUIRED', 'Not Required'), ('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected')], default='NOT_REQUIRED', help_text='Approval workflow status', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('allow_self_verification', models.BooleanField(default=False, help_text='Allow initiator/assignee to verify their own CAPA (requires justification)')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.capa')),
                ('part', models.ForeignKey(blank=True, help_text='Representative part if applicable', null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.parts')),
                ('quality_reports', models.ManyToManyField(blank=True, related_name='capas', to='Tracker.qualityreports')),
                ('dispositions', models.ManyToManyField(blank=True, related_name='capas', to='Tracker.quarantinedisposition')),
            ],
            options={
                'verbose_name': 'CAPA',
                'verbose_name_plural': 'CAPAs',
                'ordering': ['-initiated_date'],
                'permissions': [('initiate_capa', 'Can initiate new CAPAs'), ('close_capa', 'Can close CAPAs'), ('approve_capa', 'Can approve CAPAs'), ('verify_capa', 'Can verify CAPA effectiveness')],
            },
        ),
        migrations.CreateModel(
            name='RcaRecord',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('rca_method', models.CharField(choices=[('FIVE_WHYS', '5 Whys'), ('FISHBONE', 'Fishbone Diagram'), ('FAULT_TREE', 'Fault Tree'), ('PARETO', 'Pareto Analysis')], max_length=20)),
                ('problem_description', models.TextField()),
                ('root_cause_summary', models.TextField(blank=True, null=True)),
                ('rca_review_status', models.CharField(choices=[('NOT_REQUIRED', 'Not Required'), ('REQUIRED', 'Required'), ('COMPLETED', 'Completed')], default='NOT_REQUIRED', max_length=20)),
                ('root_cause_verification_status', models.CharField(choices=[('UNVERIFIED', 'Unverified'), ('VERIFIED', 'Verified'), ('DISPUTED', 'Disputed')], default='UNVERIFIED', max_length=20)),
                ('root_cause_verified_at', models.DateTimeField(blank=True, null=True)),
                ('self_verified', models.BooleanField(default=False, help_text='True if conductor verified their own RCA')),
                ('conducted_date', models.DateField(blank=True, null=True)),
                ('capa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rca_records', to='Tracker.capa')),
                ('dispositions', models.ManyToManyField(blank=True, related_name='rca_records', to='Tracker.quarantinedisposition')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.rcarecord')),
                ('quality_reports', models.ManyToManyField(blank=True, related_name='rca_records', to='Tracker.qualityreports')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'RCA Record',
                'verbose_name_plural': 'RCA Records',
                'ordering': ['-created_at'],
                'permissions': [('conduct_rca', 'Can conduct root cause analysis'), ('review_rca', 'Can review RCA findings')],
            },
        ),
        migrations.CreateModel(
            name='SamplingAuditLog',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('sampling_decision', models.BooleanField()),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('ruleset_type', models.CharField(choices=[('PRIMARY', 'Primary Ruleset'), ('FALLBACK', 'Fallback Ruleset')], max_length=20)),
                ('part', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.samplingauditlog')),
            ],
            options={
                'verbose_name': 'Sampling Audit Log',
                'verbose_name_plural': 'Sampling Audit Logs',
            },
        ),
        migrations.AddField(
            model_name='qualityreports',
            name='sampling_audit_log',
            field=models.ForeignKey(blank=True, help_text='Links to the sampling decision that triggered this inspection', null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.samplingauditlog'),
        ),
        migrations.CreateModel(
            name='SamplingRule',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('rule_type', models.CharField(choices=[('every_nth_part', 'Every Nth Part'), ('percentage', 'Percentage of Parts'), ('random', 'Pure Random'), ('first_n_parts', 'First N Parts'), ('last_n_parts', 'Last N Parts'), ('exact_count', 'Exact Count (No Variance)')], max_length=32)),
                ('value', models.PositiveIntegerField(blank=True, null=True)),
                ('order', models.PositiveIntegerField(default=0)),
                ('algorithm_description', models.TextField(default='SHA-256 hash modulo arithmetic', help_text='Description of sampling algorithm for audit purposes')),
                ('last_validated', models.DateTimeField(blank=True, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.samplingrule')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='samplingauditlog',
            name='rule',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.samplingrule'),
        ),
        migrations.AddField(
            model_name='parts',
            name='sampling_rule',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sampled_parts', to='Tracker.samplingrule'),
        ),
        migrations.CreateModel(
            name='SamplingRuleSet',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=100)),
                ('origin', models.CharField(blank=True, max_length=100)),
                ('active', models.BooleanField(default=True)),
                ('fallback_threshold', models.PositiveIntegerField(blank=True, help_text='Number of consecutive failures before switching to fallback', null=True)),
                ('fallback_duration', models.PositiveIntegerField(blank=True, help_text='Number of good parts required before reverting to this ruleset', null=True)),
                ('is_fallback', models.BooleanField(default=False)),
                ('fallback_ruleset', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='used_as_fallback_for', to='Tracker.samplingruleset')),
                ('part_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.parttypes')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.samplingruleset')),
                ('process', models.ForeignKey(blank=True, help_text='Optional process context. Steps can be in multiple processes.', null=True, on_delete=django.db.models.deletion.CASCADE, to='Tracker.processes')),
                ('supersedes', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='superseded_by', to='Tracker.samplingruleset')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='samplingrule',
            name='ruleset',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rules', to='Tracker.samplingruleset'),
        ),
        migrations.AddField(
            model_name='parts',
            name='sampling_ruleset',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sampled_parts', to='Tracker.samplingruleset'),
        ),
        migrations.CreateModel(
            name='Shift',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=50)),
                ('code', models.CharField(max_length=10)),
                ('start_time', models.TimeField()),
                ('end_time', models.TimeField()),
                ('days_of_week', models.CharField(default='0,1,2,3,4', help_text='Comma-separated day numbers (0=Monday, 6=Sunday)', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.shift')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Shift',
                'verbose_name_plural': 'Shifts',
                'ordering': ['start_time'],
            },
        ),
        migrations.CreateModel(
            name='StepMeasurementRequirement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_mandatory', models.BooleanField(default=True, help_text='Must be recorded to advance step')),
                ('sequence', models.PositiveIntegerField(default=0, help_text='Display/collection order')),
                ('characteristic_number', models.CharField(blank=True, help_text='Balloon number on drawing', max_length=20)),
                ('tolerance_upper_override', models.FloatField(blank=True, null=True)),
                ('tolerance_lower_override', models.FloatField(blank=True, null=True)),
                ('measurement', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.measurementdefinition')),
            ],
            options={
                'ordering': ['sequence'],
            },
        ),
        migrations.CreateModel(
            name='Steps',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=50)),
                ('pass_threshold', models.FloatField(default=1.0)),
                ('expected_duration', models.DurationField(blank=True, null=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('block_on_quarantine', models.BooleanField(default=False)),
                ('requires_qa_signoff', models.BooleanField(default=False)),
                ('sampling_required', models.BooleanField(default=False)),
                ('min_sampling_rate', models.FloatField(default=0.0, help_text='Minimum % of parts that must be sampled at this step')),
                ('step_type', models.CharField(choices=[('task', 'Task'), ('start', 'Start'), ('decision', 'Decision'), ('rework', 'Rework'), ('timer', 'Timer/Wait'), ('terminal', 'Terminal')], default='task', help_text='Visual type for flow editor.', max_length=20)),
                ('is_decision_point', models.BooleanField(default=False)),
                ('decision_type', models.CharField(blank=True, choices=[('qa_result', 'Based on QA Pass/Fail'), ('measurement', 'Based on Measurement Threshold'), ('manual', 'Manual Operator Selection')], max_length=20)),
                ('is_terminal', models.BooleanField(default=False)),
                ('terminal_status', models.CharField(blank=True, choices=[('completed', 'Completed Successfully'), ('shipped', 'Shipped to Customer'), ('stock', 'Put into Inventory'), ('scrapped', 'Scrapped'), ('returned', 'Returned to Supplier'), ('awaiting_pickup', 'Awaiting Customer Pickup'), ('core_banked', 'Core Banked'), ('rma_closed', 'RMA Closed')], max_length=20)),
                ('max_visits', models.PositiveIntegerField(blank=True, help_text='Max times a part can visit this step. Null = unlimited.', null=True)),
                ('revisit_assignment', models.CharField(choices=[('any', 'Any Qualified Operator'), ('same', 'Same as Previous'), ('different', 'Different Operator'), ('role', 'Specific Role')], default='any', max_length=20)),
                ('part_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='steps', to='Tracker.parttypes')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.steps')),
                ('required_measurements', models.ManyToManyField(blank=True, help_text='Measurements that must be collected during this step', related_name='required_on_steps', through='Tracker.StepMeasurementRequirement', to='Tracker.measurementdefinition')),
                ('revisit_role', models.ForeignKey(blank=True, help_text="Required role when revisit_assignment='role'", null=True, on_delete=django.db.models.deletion.SET_NULL, to='auth.group')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Step',
                'verbose_name_plural': 'Steps',
                'ordering': ['part_type', 'name'],
            },
        ),
        migrations.AddField(
            model_name='stepmeasurementrequirement',
            name='step',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='samplingruleset',
            name='step',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sampling_ruleset', to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='quarantinedisposition',
            name='step',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='dispositions', to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='qualityreports',
            name='step',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='parts',
            name='step',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='active_parts', to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='measurementdefinition',
            name='step',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='measurement_definitions', to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='capa',
            name='step',
            field=models.ForeignKey(blank=True, help_text='Process step where issue occurred', null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.steps'),
        ),
        migrations.AddField(
            model_name='samplingruleset',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.AddField(
            model_name='samplingrule',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.AddField(
            model_name='samplingauditlog',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.CreateModel(
            name='RootCause',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('description', models.TextField()),
                ('category', models.CharField(choices=[('MAN', 'Man (People)'), ('MACHINE', 'Machine (Equipment)'), ('MATERIAL', 'Material'), ('METHOD', 'Method (Process)'), ('MEASUREMENT', 'Measurement'), ('ENVIRONMENT', 'Environment'), ('OTHER', 'Other')], max_length=20)),
                ('role', models.CharField(choices=[('PRIMARY', 'Primary'), ('CONTRIBUTING', 'Contributing')], default='PRIMARY', max_length=20)),
                ('sequence', models.IntegerField(default=1, help_text='Order in causal chain')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.rootcause')),
                ('rca_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='root_causes', to='Tracker.rcarecord')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Root Cause',
                'verbose_name_plural': 'Root Causes',
                'ordering': ['rca_record', 'sequence'],
            },
        ),
        migrations.AddField(
            model_name='quarantinedisposition',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.AddField(
            model_name='qualityreports',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.AddField(
            model_name='parts',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.AddField(
            model_name='measurementdefinition',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.CreateModel(
            name='FiveWhys',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('why_1_question', models.TextField(blank=True, null=True)),
                ('why_1_answer', models.TextField(blank=True, null=True)),
                ('why_2_question', models.TextField(blank=True, null=True)),
                ('why_2_answer', models.TextField(blank=True, null=True)),
                ('why_3_question', models.TextField(blank=True, null=True)),
                ('why_3_answer', models.TextField(blank=True, null=True)),
                ('why_4_question', models.TextField(blank=True, null=True)),
                ('why_4_answer', models.TextField(blank=True, null=True)),
                ('why_5_question', models.TextField(blank=True, null=True)),
                ('why_5_answer', models.TextField(blank=True, null=True)),
                ('identified_root_cause', models.TextField(blank=True, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.fivewhys')),
                ('rca_record', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='five_whys', to='Tracker.rcarecord')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': '5 Whys Analysis',
                'verbose_name_plural': '5 Whys Analyses',
            },
        ),
        migrations.CreateModel(
            name='Fishbone',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('problem_statement', models.TextField()),
                ('man_causes', models.JSONField(blank=True, default=list, help_text='Array of cause strings')),
                ('machine_causes', models.JSONField(blank=True, default=list)),
                ('material_causes', models.JSONField(blank=True, default=list)),
                ('method_causes', models.JSONField(blank=True, default=list)),
                ('measurement_causes', models.JSONField(blank=True, default=list)),
                ('environment_causes', models.JSONField(blank=True, default=list)),
                ('identified_root_cause', models.TextField(blank=True, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.fishbone')),
                ('rca_record', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='fishbone', to='Tracker.rcarecord')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Fishbone Diagram',
                'verbose_name_plural': 'Fishbone Diagrams',
            },
        ),
        migrations.CreateModel(
            name='Facility',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text="Display name (e.g., 'Plant A')", max_length=100)),
                ('code', models.CharField(help_text="Short code (e.g., 'PLANT-A', 'MFG-01')", max_length=20)),
                ('address', models.TextField(blank=True)),
                ('tz', models.CharField(default='UTC', help_text="IANA timezone (e.g., 'America/New_York')", max_length=50)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='facilities', to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Facility',
                'verbose_name_plural': 'Facilities',
                'db_table': 'tracker_facility',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='DisassemblyBOMLine',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('expected_qty', models.PositiveIntegerField(default=1, help_text='Number of this component expected per core')),
                ('expected_fallout_rate', models.DecimalField(decimal_places=2, default=0, help_text="Expected percentage of components that won't be usable (0.10 = 10%)", max_digits=5)),
                ('notes', models.TextField(blank=True, help_text='Special handling instructions or notes')),
                ('line_number', models.PositiveIntegerField(default=0)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.disassemblybomline')),
                ('component_type', models.ForeignKey(help_text='The type of component expected from disassembly', on_delete=django.db.models.deletion.PROTECT, related_name='harvested_from_bom', to='Tracker.parttypes')),
                ('core_type', models.ForeignKey(help_text='The type of core being disassembled', on_delete=django.db.models.deletion.PROTECT, related_name='disassembly_bom_lines', to='Tracker.parttypes')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Disassembly BOM Line',
                'verbose_name_plural': 'Disassembly BOM Lines',
                'ordering': ['core_type', 'line_number'],
            },
        ),
        migrations.AddField(
            model_name='core',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.AddField(
            model_name='capa',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.CreateModel(
            name='CalibrationRecord',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('calibration_date', models.DateField()),
                ('due_date', models.DateField()),
                ('result', models.CharField(choices=[('pass', 'Pass'), ('fail', 'Fail'), ('limited', 'Limited/Restricted Use')], default='pass', max_length=10)),
                ('calibration_type', models.CharField(choices=[('scheduled', 'Scheduled'), ('initial', 'Initial'), ('after_repair', 'After Repair'), ('after_adjustment', 'After Adjustment'), ('verification', 'Verification Check')], default='scheduled', max_length=20)),
                ('performed_by', models.CharField(blank=True, help_text='Person or lab that performed calibration', max_length=200)),
                ('external_lab', models.CharField(blank=True, help_text='External calibration lab name if sent out', max_length=200)),
                ('certificate_number', models.CharField(blank=True, help_text='Calibration certificate number for traceability', max_length=100)),
                ('standards_used', models.TextField(blank=True, help_text="Reference standards used with traceability info (e.g., 'NIST-traceable gauge blocks, cert #12345')")),
                ('as_found_in_tolerance', models.BooleanField(blank=True, help_text='Was equipment within tolerance when received for calibration?', null=True)),
                ('adjustments_made', models.BooleanField(default=False, help_text='Were adjustments made during calibration?')),
                ('notes', models.TextField(blank=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.calibrationrecord')),
                ('equipment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='calibration_records', to='Tracker.equipments')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Calibration Record',
                'verbose_name_plural': 'Calibration Records',
                'ordering': ['-calibration_date'],
                'get_latest_by': 'calibration_date',
            },
        ),
        migrations.AddField(
            model_name='bom',
            name='tenant',
            field=models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant'),
        ),
        migrations.CreateModel(
            name='TenantGroup',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Display name', max_length=100)),
                ('description', models.TextField(blank=True)),
                ('is_custom', models.BooleanField(default=False, help_text='True if created by tenant admin, False if seeded from presets')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this group (customizable per tenant)', related_name='tenant_groups', to='auth.permission')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='custom_groups', to='Tracker.tenant')),
            ],
            options={
                'db_table': 'tracker_tenant_group',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='GroupApproverAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sequence_order', models.PositiveIntegerField(blank=True, help_text='Order in sequential approval flow (null for parallel)', null=True)),
                ('assignment_source', models.CharField(choices=[('TEMPLATE_DEFAULT', 'Template Default'), ('TEMPLATE_GROUP', 'Template Group Auto-Assign'), ('MANUAL', 'Manual Assignment'), ('DELEGATION', 'Delegated'), ('ESCALATION', 'Escalation')], default='TEMPLATE_GROUP', max_length=20)),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('approval_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='group_assignments', to='Tracker.approvalrequest')),
                ('group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approval_assignments', to='Tracker.tenantgroup')),
            ],
            options={
                'db_table': 'tracker_group_approver_assignment',
                'ordering': ['sequence_order', 'assigned_at'],
            },
        ),
        migrations.AddField(
            model_name='approvaltemplate',
            name='default_groups',
            field=models.ManyToManyField(blank=True, related_name='default_approval_templates', to='Tracker.tenantgroup'),
        ),
        migrations.AddField(
            model_name='approvalrequest',
            name='approver_groups',
            field=models.ManyToManyField(blank=True, related_name='approval_requests_group_assigned', through='Tracker.GroupApproverAssignment', to='Tracker.tenantgroup'),
        ),
        migrations.CreateModel(
            name='ThreeDModel',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=255)),
                ('file', models.FileField(upload_to=Tracker.models.qms.threed_model_upload_path)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('file_type', models.CharField(help_text='e.g., glb, gltf, obj', max_length=50)),
                ('part_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='three_d_models', to='Tracker.parttypes')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.threedmodel')),
                ('step', models.ForeignKey(blank=True, help_text='Optional: Link to specific step if this shows intermediate state', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='three_d_models', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': '3D Model',
                'verbose_name_plural': '3D Models',
            },
        ),
        migrations.CreateModel(
            name='TrainingType',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('validity_period_days', models.PositiveIntegerField(blank=True, help_text='Default number of days training is valid. Null = never expires.', null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.trainingtype')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Training Type',
                'verbose_name_plural': 'Training Types',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='TrainingRequirement',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True, help_text="Why is this required? e.g., 'Per WI-042' or 'Customer requirement'")),
                ('equipment_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='training_requirements', to='Tracker.equipmenttype')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.trainingrequirement')),
                ('process', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='training_requirements', to='Tracker.processes')),
                ('step', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='training_requirements', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('training_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='requirements', to='Tracker.trainingtype')),
            ],
            options={
                'verbose_name': 'Training Requirement',
                'verbose_name_plural': 'Training Requirements',
            },
        ),
        migrations.CreateModel(
            name='WorkCenter',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=100)),
                ('code', models.CharField(max_length=20)),
                ('description', models.TextField(blank=True)),
                ('capacity_units', models.CharField(default='hours', help_text='Unit of measure for capacity (hours, pieces, etc.)', max_length=20)),
                ('default_efficiency', models.DecimalField(decimal_places=2, default=100.0, help_text='Default efficiency percentage (100 = 100%)', max_digits=5)),
                ('cost_center', models.CharField(blank=True, max_length=50)),
                ('equipment', models.ManyToManyField(blank=True, related_name='work_centers', to='Tracker.equipments')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.workcenter')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Work Center',
                'verbose_name_plural': 'Work Centers',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='WorkOrder',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('workorder_status', models.CharField(choices=[('PENDING', 'Pending'), ('IN_PROGRESS', 'In progress'), ('COMPLETED', 'Completed'), ('ON_HOLD', 'On hold'), ('CANCELLED', 'Cancelled'), ('WAITING_FOR_OPERATOR', 'Waiting for operator')], default='PENDING', max_length=50)),
                ('quantity', models.IntegerField(default=1)),
                ('ERP_id', models.CharField(max_length=50)),
                ('expected_completion', models.DateField(blank=True, null=True)),
                ('expected_duration', models.DurationField(blank=True, null=True)),
                ('true_completion', models.DateField(blank=True, null=True)),
                ('true_duration', models.DurationField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, max_length=500, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.workorder')),
                ('process', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='work_orders', to='Tracker.processes')),
                ('related_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='related_orders', to='Tracker.orders')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
            ],
            options={
                'verbose_name': 'Work Order',
                'verbose_name_plural': 'Work Orders',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ScheduleSlot',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('scheduled_date', models.DateField()),
                ('scheduled_start', models.DateTimeField()),
                ('scheduled_end', models.DateTimeField()),
                ('actual_start', models.DateTimeField(blank=True, null=True)),
                ('actual_end', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('scheduled', 'Scheduled'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='scheduled', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.scheduleslot')),
                ('shift', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='schedule_slots', to='Tracker.shift')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_center', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schedule_slots', to='Tracker.workcenter')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schedule_slots', to='Tracker.workorder')),
            ],
            options={
                'verbose_name': 'Schedule Slot',
                'verbose_name_plural': 'Schedule Slots',
                'ordering': ['scheduled_date', 'scheduled_start'],
            },
        ),
        migrations.CreateModel(
            name='SamplingAnalytics',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('parts_sampled', models.PositiveIntegerField(default=0)),
                ('parts_total', models.PositiveIntegerField(default=0)),
                ('defects_found', models.PositiveIntegerField(default=0)),
                ('actual_sampling_rate', models.FloatField()),
                ('target_sampling_rate', models.FloatField()),
                ('variance', models.FloatField()),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.samplinganalytics')),
                ('ruleset', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.samplingruleset')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.workorder')),
            ],
            options={
                'verbose_name': 'Sampling Analytics',
                'verbose_name_plural': 'Sampling Analytics',
            },
        ),
        migrations.AddField(
            model_name='parts',
            name='work_order',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='parts', to='Tracker.workorder'),
        ),
        migrations.AddField(
            model_name='core',
            name='work_order',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cores', to='Tracker.workorder'),
        ),
        migrations.AddField(
            model_name='capa',
            name='work_order',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.workorder'),
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='email address')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('user_type', models.CharField(choices=[('internal', 'Internal'), ('portal', 'Portal')], default='internal', help_text='Type of user account', max_length=20)),
                ('first_name', models.CharField(blank=True, max_length=150, null=True)),
                ('last_name', models.CharField(blank=True, max_length=150, null=True)),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now)),
                ('citizenship', models.CharField(blank=True, help_text='ISO 3166-1 alpha-3 country code (e.g., USA, GBR, DEU)', max_length=3)),
                ('us_person', models.BooleanField(default=False, help_text="ITAR 'US Person': US citizen, permanent resident, or protected individual (22 CFR 120.62)")),
                ('eu_authorized', models.BooleanField(default=False, help_text='EU Person: Authorized under EU Dual-Use Regulation (EC 428/2009)')),
                ('uk_authorized', models.BooleanField(default=False, help_text='UK Person: Authorized under UK Export Control Act 2002 / ECJU')),
                ('export_control_verified', models.BooleanField(default=False, help_text='Whether export control status has been verified by authorized personnel')),
                ('export_control_verified_at', models.DateTimeField(blank=True, help_text='When export control status was last verified', null=True)),
                ('export_control_notes', models.TextField(blank=True, help_text='Notes on special authorizations (TAAs, specific licenses, Canadian exemption, etc.)')),
                ('export_control_verified_by', models.ForeignKey(blank=True, help_text='User who verified export control status', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='export_verifications_performed', to=settings.AUTH_USER_MODEL)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('parent_company', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='users', to='Tracker.companies')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this user belongs to', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='users', to='Tracker.tenant')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'verbose_name': 'User',
                'verbose_name_plural': 'Users',
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name='UserRole',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('granted_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('company', models.ForeignKey(blank=True, help_text='For customer/external roles: which company they represent', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='customer_roles', to='Tracker.companies')),
                ('facility', models.ForeignKey(blank=True, help_text='Null = access to all facilities in tenant', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='role_assignments', to='Tracker.facility')),
                ('group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='role_assignments', to='Tracker.tenantgroup')),
                ('granted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='roles_granted', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_roles', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Role',
                'verbose_name_plural': 'User Roles',
                'db_table': 'tracker_user_role',
            },
        ),
        migrations.CreateModel(
            name='UserInvitation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('token', models.CharField(db_index=True, max_length=64, unique=True)),
                ('sent_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
                ('accepted_at', models.DateTimeField(blank=True, null=True)),
                ('accepted_ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('accepted_user_agent', models.TextField(blank=True, null=True)),
                ('invited_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invitations_sent', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='invitations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Invitation',
                'verbose_name_plural': 'User Invitations',
                'ordering': ['-sent_at'],
            },
        ),
        migrations.CreateModel(
            name='TrainingRecord',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('completed_date', models.DateField()),
                ('expires_date', models.DateField(blank=True, help_text='Date training expires. Null = never expires.', null=True)),
                ('notes', models.TextField(blank=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.trainingrecord')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('training_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='records', to='Tracker.trainingtype')),
                ('trainer', models.ForeignKey(blank=True, help_text='Person who conducted the training', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='trainings_given', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_records', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Training Record',
                'verbose_name_plural': 'Training Records',
                'ordering': ['-completed_date'],
            },
        ),
        migrations.CreateModel(
            name='TimeEntry',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('entry_type', models.CharField(choices=[('production', 'Production'), ('setup', 'Setup/Changeover'), ('rework', 'Rework'), ('downtime', 'Downtime'), ('indirect', 'Indirect Labor')], max_length=20)),
                ('start_time', models.DateTimeField()),
                ('end_time', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('downtime_reason', models.CharField(blank=True, max_length=100)),
                ('approved', models.BooleanField(default=False)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('equipment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='time_entries', to='Tracker.equipments')),
                ('part', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='time_entries', to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.timeentry')),
                ('step', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='time_entries', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_center', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='time_entries', to='Tracker.workcenter')),
                ('work_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='time_entries', to='Tracker.workorder')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_time_entries', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='time_entries', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Time Entry',
                'verbose_name_plural': 'Time Entries',
                'ordering': ['-start_time'],
            },
        ),
        migrations.CreateModel(
            name='TenantGroupMembership',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('granted_at', models.DateTimeField(auto_now_add=True)),
                ('group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tenant_memberships', to='auth.group')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='group_memberships', to='Tracker.tenant')),
                ('granted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='group_grants_made', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tenant_group_memberships', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tenant Group Membership',
                'verbose_name_plural': 'Tenant Group Memberships',
            },
        ),
        migrations.CreateModel(
            name='StepTransitionLog',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True, help_text='Timestamp automatically recorded at the time of transition.')),
                ('part', models.ForeignKey(blank=True, help_text='The part that transitioned to the step.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.steptransitionlog')),
                ('step', models.ForeignKey(blank=True, help_text='The step the part transitioned to.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('operator', models.ForeignKey(blank=True, help_text='The user (operator) who performed the step transition.', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Step Transition Log',
                'verbose_name_plural': 'Step Transition Log',
            },
        ),
        migrations.AddField(
            model_name='steps',
            name='notification_users',
            field=models.ManyToManyField(blank=True, related_name='notification_users', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='StepExecution',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('visit_number', models.PositiveIntegerField(default=1, help_text='Which visit this is (1st, 2nd, 3rd time at this step)')),
                ('entered_at', models.DateTimeField(auto_now_add=True)),
                ('exited_at', models.DateTimeField(blank=True, null=True)),
                ('decision_result', models.CharField(blank=True, help_text="Result of decision: 'pass', 'fail', measurement value, etc.", max_length=50)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('skipped', 'Skipped')], default='pending', max_length=20)),
                ('part', models.ForeignKey(help_text='The part being tracked through this step', on_delete=django.db.models.deletion.CASCADE, related_name='step_executions', to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.stepexecution')),
                ('next_step', models.ForeignKey(blank=True, help_text='The step this part moved to (for audit trail)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incoming_executions', to='Tracker.steps')),
                ('step', models.ForeignKey(help_text='The step being executed', on_delete=django.db.models.deletion.PROTECT, related_name='executions', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('assigned_to', models.ForeignKey(blank=True, help_text='Operator assigned to this step execution', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_step_executions', to=settings.AUTH_USER_MODEL)),
                ('completed_by', models.ForeignKey(blank=True, help_text='Operator who completed this step', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='completed_step_executions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Step Execution',
                'verbose_name_plural': 'Step Executions',
                'ordering': ['entered_at'],
            },
        ),
        migrations.CreateModel(
            name='SPCBaseline',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('chart_type', models.CharField(choices=[('XBAR_R', 'X-R'), ('XBAR_S', 'X-S'), ('I_MR', 'I-MR')], help_text='Type of control chart (X-bar R, X-bar S, or I-MR)', max_length=10)),
                ('subgroup_size', models.PositiveIntegerField(default=5, help_text='Number of samples per subgroup (n=2 to 25 for X-bar charts, n=1 for I-MR)')),
                ('xbar_ucl', models.DecimalField(blank=True, decimal_places=6, help_text='X-bar chart Upper Control Limit', max_digits=16, null=True)),
                ('xbar_cl', models.DecimalField(blank=True, decimal_places=6, help_text='X-bar chart Center Line (grand mean)', max_digits=16, null=True)),
                ('xbar_lcl', models.DecimalField(blank=True, decimal_places=6, help_text='X-bar chart Lower Control Limit', max_digits=16, null=True)),
                ('range_ucl', models.DecimalField(blank=True, decimal_places=6, help_text='Range (or S) chart Upper Control Limit', max_digits=16, null=True)),
                ('range_cl', models.DecimalField(blank=True, decimal_places=6, help_text='Range (or S) chart Center Line', max_digits=16, null=True)),
                ('range_lcl', models.DecimalField(blank=True, decimal_places=6, help_text='Range (or S) chart Lower Control Limit', max_digits=16, null=True)),
                ('individual_ucl', models.DecimalField(blank=True, decimal_places=6, help_text='Individual chart Upper Control Limit', max_digits=16, null=True)),
                ('individual_cl', models.DecimalField(blank=True, decimal_places=6, help_text='Individual chart Center Line', max_digits=16, null=True)),
                ('individual_lcl', models.DecimalField(blank=True, decimal_places=6, help_text='Individual chart Lower Control Limit', max_digits=16, null=True)),
                ('mr_ucl', models.DecimalField(blank=True, decimal_places=6, help_text='Moving Range chart Upper Control Limit', max_digits=16, null=True)),
                ('mr_cl', models.DecimalField(blank=True, decimal_places=6, help_text='Moving Range chart Center Line', max_digits=16, null=True)),
                ('status', models.CharField(choices=[('ACTIVE', 'Active'), ('SUPERSEDED', 'Superseded')], default='ACTIVE', help_text='Current status of this baseline', max_length=15)),
                ('frozen_at', models.DateTimeField(auto_now_add=True, help_text='Timestamp when baseline was frozen')),
                ('superseded_at', models.DateTimeField(blank=True, help_text='Timestamp when this baseline was superseded', null=True)),
                ('superseded_reason', models.TextField(blank=True, help_text='Reason for superseding this baseline')),
                ('sample_count', models.PositiveIntegerField(default=0, help_text='Number of data points used to calculate this baseline')),
                ('notes', models.TextField(blank=True, help_text='Additional notes about this baseline')),
                ('measurement_definition', models.ForeignKey(help_text='The measurement definition this baseline applies to', on_delete=django.db.models.deletion.CASCADE, related_name='spc_baselines', to='Tracker.measurementdefinition')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.spcbaseline')),
                ('superseded_by', models.ForeignKey(blank=True, help_text='The baseline that replaced this one', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supersedes', to='Tracker.spcbaseline')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('frozen_by', models.ForeignKey(help_text='User who froze/created this baseline', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='frozen_spc_baselines', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'SPC Baseline',
                'verbose_name_plural': 'SPC Baselines',
                'ordering': ['-frozen_at'],
            },
        ),
        migrations.CreateModel(
            name='SamplingTriggerState',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('active', models.BooleanField(default=True)),
                ('triggered_at', models.DateTimeField(auto_now_add=True)),
                ('success_count', models.PositiveIntegerField(default=0)),
                ('fail_count', models.PositiveIntegerField(default=0)),
                ('notification_sent', models.BooleanField(default=False)),
                ('notification_sent_at', models.DateTimeField(blank=True, null=True)),
                ('parts_inspected', models.ManyToManyField(blank=True, to='Tracker.parts')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.samplingtriggerstate')),
                ('ruleset', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.samplingruleset')),
                ('triggered_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.qualityreports')),
                ('step', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.workorder')),
                ('notified_users', models.ManyToManyField(blank=True, related_name='sampling_notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Sampling Trigger State',
                'verbose_name_plural': 'Sampling Trigger States',
            },
        ),
        migrations.AddField(
            model_name='samplingruleset',
            name='created_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='samplingruleset',
            name='modified_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='samplingrule',
            name='created_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='samplingrule',
            name='modified_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='rcarecord',
            name='conducted_by',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rca_conducted', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='rcarecord',
            name='root_cause_verified_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rca_verifications', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='quarantinedisposition',
            name='assigned_to',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='assigned_dispositions', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='quarantinedisposition',
            name='containment_completed_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='containment_actions', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='quarantinedisposition',
            name='resolution_completed_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='completed_dispositions', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='quarantinedisposition',
            name='scrap_verified_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='scrap_verifications', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='qualityreports',
            name='detected_by',
            field=models.ForeignKey(help_text='Inspector/operator who detected the defect (required for new reports)', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='defects_detected', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='qualityreports',
            name='operator',
            field=models.ForeignKey(blank=True, help_text='Operator running the process when defect occurred (for root cause)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='defects_during_operation', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='qualityreports',
            name='verified_by',
            field=models.ForeignKey(blank=True, help_text='Second signature for critical inspections (aerospace/medical)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='defects_verified', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='QaApproval',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.qaapproval')),
                ('step', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='qa_approvals', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='qa_approvals', to='Tracker.workorder')),
                ('qa_staff', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='qa_approvals', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='processes',
            name='approved_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_processes', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='PermissionChangeLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('timestamp', models.DateTimeField(db_index=True, default=django.utils.timezone.now, editable=False)),
                ('group_name', models.CharField(db_index=True, max_length=150)),
                ('permission_codename', models.CharField(blank=True, help_text='Permission codename (empty for group create/delete)', max_length=255)),
                ('action', models.CharField(choices=[('added', 'Permission Added'), ('removed', 'Permission Removed'), ('group_created', 'Group Created'), ('group_deleted', 'Group Deleted')], max_length=20)),
                ('source', models.CharField(choices=[('migration', 'Database Migration'), ('post_migrate', 'Post-Migrate Signal'), ('management_cmd', 'Management Command'), ('admin_ui', 'Admin Interface'), ('api', 'API Call')], default='management_cmd', max_length=20)),
                ('reason', models.TextField(blank=True, help_text='Why this change was made')),
                ('permissions_before', models.IntegerField(default=0, help_text='Number of permissions in group before change')),
                ('permissions_after', models.IntegerField(default=0, help_text='Number of permissions in group after change')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant scope for this change (null for system-wide operations)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='permission_change_logs', to='Tracker.tenant')),
                ('changed_by', models.ForeignKey(blank=True, help_text='User who made the change (null for system operations)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='permission_changes_made', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Permission Change Log',
                'verbose_name_plural': 'Permission Change Logs',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='OrderViewer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('invitation_type', models.CharField(choices=[('direct', 'Direct Invitation'), ('company', 'Company Member'), ('staff', 'Staff Assigned')], default='direct', max_length=20)),
                ('invited_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Optional expiration for temporary access', null=True)),
                ('order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.orders')),
                ('invited_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='order_invitations_sent', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='orders',
            name='customer',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='customer_orders', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='orders',
            name='viewers',
            field=models.ManyToManyField(blank=True, related_name='viewable_orders', through='Tracker.OrderViewer', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='NotificationTask',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('notification_type', models.CharField(choices=[('WEEKLY_REPORT', 'Weekly Order Report'), ('CAPA_REMINDER', 'CAPA Reminder'), ('APPROVAL_REQUEST', 'Approval Request'), ('APPROVAL_DECISION', 'Approval Decision'), ('APPROVAL_ESCALATION', 'Approval Escalation')], max_length=50)),
                ('channel_type', models.CharField(choices=[('email', 'Email'), ('in_app', 'In-App Notification'), ('sms', 'SMS')], default='email', max_length=20)),
                ('interval_type', models.CharField(choices=[('fixed', 'Fixed Interval'), ('deadline_based', 'Deadline Based')], max_length=20)),
                ('day_of_week', models.IntegerField(blank=True, help_text='0=Monday, 6=Sunday', null=True)),
                ('time', models.TimeField(blank=True, help_text='Time in UTC', null=True)),
                ('interval_weeks', models.IntegerField(blank=True, help_text='Number of weeks between sends', null=True)),
                ('deadline', models.DateTimeField(blank=True, help_text='Deadline for escalation calculation', null=True)),
                ('escalation_tiers', models.JSONField(blank=True, help_text='List of [threshold_days, interval_days] tuples. Example: [[28, 28], [14, 7], [0, 3.5], [-999, 1]]', null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('attempt_count', models.IntegerField(default=0)),
                ('last_sent_at', models.DateTimeField(blank=True, null=True)),
                ('next_send_at', models.DateTimeField(db_index=True, help_text='When this notification should be sent (UTC)')),
                ('max_attempts', models.IntegerField(blank=True, help_text='Max sends before stopping. Null = infinite', null=True)),
                ('related_object_id', models.CharField(blank=True, max_length=36, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('related_content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype')),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notification_tasks', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Notification Task',
                'verbose_name_plural': 'Notification Tasks',
                'ordering': ['next_send_at'],
            },
        ),
        migrations.CreateModel(
            name='MeasurementResult',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('value_numeric', models.FloatField(blank=True, null=True)),
                ('value_pass_fail', models.CharField(blank=True, choices=[('PASS', 'Pass'), ('FAIL', 'Fail')], max_length=4, null=True)),
                ('is_within_spec', models.BooleanField()),
                ('definition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='Tracker.measurementdefinition')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.measurementresult')),
                ('report', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='measurements', to='Tracker.qualityreports')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='MaterialUsage',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('qty_consumed', models.DecimalField(decimal_places=4, max_digits=12)),
                ('consumed_at', models.DateTimeField(auto_now_add=True)),
                ('is_substitute', models.BooleanField(default=False, help_text='True if this material was a substitute for the BOM-specified material')),
                ('substitution_reason', models.CharField(blank=True, max_length=200)),
                ('harvested_component', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='usages', to='Tracker.harvestedcomponent')),
                ('lot', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='usages', to='Tracker.materiallot')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.materialusage')),
                ('part', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='material_usages', to='Tracker.parts')),
                ('step', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='material_usages', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='material_usages', to='Tracker.workorder')),
                ('consumed_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='material_consumptions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Material Usage',
                'verbose_name_plural': 'Material Usages',
                'ordering': ['-consumed_at'],
            },
        ),
        migrations.AddField(
            model_name='materiallot',
            name='received_by',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='received_lots', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='HeatMapAnnotations',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('position_x', models.FloatField()),
                ('position_y', models.FloatField()),
                ('position_z', models.FloatField()),
                ('measurement_value', models.FloatField(blank=True, null=True)),
                ('defect_type', models.CharField(blank=True, max_length=255, null=True)),
                ('severity', models.CharField(blank=True, choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], max_length=50, null=True)),
                ('notes', models.TextField(blank=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.heatmapannotations')),
                ('part', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='heatmap_annotations', to='Tracker.parts')),
                ('quality_reports', models.ManyToManyField(blank=True, related_name='annotations', to='Tracker.qualityreports')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('model', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='annotations', to='Tracker.threedmodel')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='heatmap_annotations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Heatmap Annotation',
                'verbose_name_plural': 'Heatmap Annotations',
            },
        ),
        migrations.AddField(
            model_name='harvestedcomponent',
            name='disassembled_by',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='harvested_components', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='harvestedcomponent',
            name='scrapped_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='scrapped_components', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='groupapproverassignment',
            name='assigned_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='group_assignments_made', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='GeneratedReport',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('report_type', models.CharField(help_text='Type of report: spc, capa, quality_report, etc.', max_length=50)),
                ('generated_at', models.DateTimeField(auto_now_add=True)),
                ('parameters', models.JSONField(default=dict, help_text='Parameters used to generate the report (for reproducibility)')),
                ('emailed_to', models.EmailField(blank=True, help_text='Email address the report was sent to', max_length=254, null=True)),
                ('emailed_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('COMPLETED', 'Completed'), ('FAILED', 'Failed')], default='PENDING', max_length=20)),
                ('error_message', models.TextField(blank=True, help_text='Error details if generation failed', null=True)),
                ('document', models.ForeignKey(blank=True, help_text='The Document containing the generated PDF file', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='generated_reports', to='Tracker.documents')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.generatedreport')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('generated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='generated_reports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Generated Report',
                'verbose_name_plural': 'Generated Reports',
                'ordering': ['-generated_at'],
            },
        ),
        migrations.CreateModel(
            name='EquipmentUsage',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('used_at', models.DateTimeField(auto_now_add=True)),
                ('notes', models.TextField(blank=True)),
                ('equipment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.equipments')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.equipmentusage')),
                ('part', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.parts')),
                ('error_report', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='equipment_usages', to='Tracker.qualityreports')),
                ('step', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Equipment Usage',
                'verbose_name_plural': 'Equipment Usage',
            },
        ),
        migrations.CreateModel(
            name='DowntimeEvent',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('category', models.CharField(choices=[('planned', 'Planned Maintenance'), ('unplanned', 'Unplanned/Breakdown'), ('changeover', 'Changeover/Setup'), ('calibration', 'Calibration'), ('no_work', 'No Work Available'), ('no_operator', 'No Operator Available'), ('material', 'Waiting for Material'), ('quality', 'Quality Issue'), ('other', 'Other')], max_length=20)),
                ('reason', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('start_time', models.DateTimeField()),
                ('end_time', models.DateTimeField(blank=True, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.downtimeevent')),
                ('equipment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='downtime_events', to='Tracker.equipments')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('work_center', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='downtime_events', to='Tracker.workcenter')),
                ('work_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='downtime_events', to='Tracker.workorder')),
                ('reported_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='reported_downtime', to=settings.AUTH_USER_MODEL)),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='resolved_downtime', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Downtime Event',
                'verbose_name_plural': 'Downtime Events',
                'ordering': ['-start_time'],
            },
        ),
        migrations.AddField(
            model_name='documents',
            name='approved_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents_approved', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='documents',
            name='uploaded_by',
            field=models.ForeignKey(auto_created=True, blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='core',
            name='disassembled_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='disassembled_cores', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='core',
            name='received_by',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='received_cores', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='ChatSession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('langgraph_thread_id', models.CharField(max_length=255)),
                ('title', models.CharField(default='New Chat', max_length=255)),
                ('is_archived', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant for data isolation (auto-set from user on creation)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='chat_sessions', to='Tracker.tenant')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'chat_sessions',
                'ordering': ['-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='CapaVerification',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('verification_method', models.TextField(help_text='How effectiveness was verified')),
                ('verification_criteria', models.TextField(help_text='What defines success')),
                ('verification_date', models.DateField(blank=True, null=True)),
                ('effectiveness_result', models.CharField(choices=[('CONFIRMED', 'Confirmed Effective'), ('NOT_EFFECTIVE', 'Not Effective'), ('INCONCLUSIVE', 'Inconclusive')], default='INCONCLUSIVE', max_length=20)),
                ('effectiveness_decided_at', models.DateTimeField(blank=True, null=True)),
                ('verification_notes', models.TextField(blank=True, null=True)),
                ('self_verified', models.BooleanField(default=False, help_text='True if initiator/assignee verified their own CAPA')),
                ('capa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='verifications', to='Tracker.capa')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.capaverification')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('verified_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capa_verifications_performed', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'CAPA Verification',
                'verbose_name_plural': 'CAPA Verifications',
            },
        ),
        migrations.CreateModel(
            name='CapaTasks',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('task_number', models.CharField(help_text='Auto-generated: {capa_number}-T{seq}', max_length=40)),
                ('task_type', models.CharField(choices=[('CONTAINMENT', 'Containment'), ('CORRECTIVE', 'Corrective Action'), ('PREVENTIVE', 'Preventive Action')], max_length=20)),
                ('description', models.TextField()),
                ('status', models.CharField(choices=[('NOT_STARTED', 'Not Started'), ('IN_PROGRESS', 'In Progress'), ('COMPLETED', 'Completed'), ('CANCELLED', 'Cancelled')], default='NOT_STARTED', max_length=20)),
                ('completion_mode', models.CharField(choices=[('SINGLE_OWNER', 'Single Owner'), ('ANY_ASSIGNEE', 'Any Assignee'), ('ALL_ASSIGNEES', 'All Assignees')], default='SINGLE_OWNER', max_length=20)),
                ('due_date', models.DateField(blank=True, null=True)),
                ('requires_signature', models.BooleanField(default=False, help_text='If true, task completion requires signature and password verification')),
                ('completed_date', models.DateField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True, null=True)),
                ('completion_signature', models.TextField(blank=True, help_text='Base64-encoded signature image data', null=True)),
                ('capa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='Tracker.capa')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.capatasks')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('assigned_to', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capa_tasks_assigned', to=settings.AUTH_USER_MODEL)),
                ('completed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capa_tasks_completed', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'CAPA Task',
                'verbose_name_plural': 'CAPA Tasks',
                'ordering': ['capa', 'created_at'],
            },
        ),
        migrations.CreateModel(
            name='CapaTaskAssignee',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('status', models.CharField(choices=[('NOT_STARTED', 'Not Started'), ('IN_PROGRESS', 'In Progress'), ('COMPLETED', 'Completed'), ('CANCELLED', 'Cancelled')], default='NOT_STARTED', max_length=20)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True, null=True)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.capataskassignee')),
                ('task', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assignees', to='Tracker.capatasks')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='capa_task_assignments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'CAPA Task Assignee',
                'verbose_name_plural': 'CAPA Task Assignees',
            },
        ),
        migrations.AddField(
            model_name='capa',
            name='approved_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capas_approved', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='capa',
            name='assigned_to',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capas_assigned', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='capa',
            name='initiated_by',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capas_initiated', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='capa',
            name='verified_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='capas_verified', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='bom',
            name='approved_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_boms', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='AssemblyUsage',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('quantity', models.DecimalField(decimal_places=4, default=1, max_digits=10)),
                ('installed_at', models.DateTimeField(auto_now_add=True)),
                ('removed_at', models.DateTimeField(blank=True, null=True)),
                ('removal_reason', models.CharField(blank=True, max_length=100)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.assemblyusage')),
                ('bom_line', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='actual_usages', to='Tracker.bomline')),
                ('assembly', models.ForeignKey(help_text='The parent assembly this component was installed into', on_delete=django.db.models.deletion.PROTECT, related_name='component_usages', to='Tracker.parts')),
                ('component', models.ForeignKey(help_text='The component part installed', on_delete=django.db.models.deletion.PROTECT, related_name='installed_in', to='Tracker.parts')),
                ('step', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assembly_installations', to='Tracker.steps')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('installed_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='installed_assemblies', to=settings.AUTH_USER_MODEL)),
                ('removed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='removed_assemblies', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Assembly Usage',
                'verbose_name_plural': 'Assembly Usages',
                'ordering': ['-installed_at'],
            },
        ),
        migrations.CreateModel(
            name='ArchiveReason',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('reason', models.CharField(choices=[('completed', 'Completed'), ('user_error', 'Archived due to User Error'), ('obsolete', 'Obsolete')], max_length=50)),
                ('notes', models.TextField(blank=True)),
                ('object_id', models.CharField(max_length=36)),
                ('archived_at', models.DateTimeField(auto_now_add=True)),
                ('content_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='contenttypes.contenttype')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.archivereason')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Archive Reason',
                'verbose_name_plural': 'Archive Reasons',
            },
        ),
        migrations.CreateModel(
            name='ApproverAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_required', models.BooleanField(default=True, help_text='True for required approvers, False for optional/FYI')),
                ('sequence_order', models.PositiveIntegerField(blank=True, help_text='Order in sequential approval flow (null for parallel)', null=True)),
                ('assignment_source', models.CharField(choices=[('TEMPLATE_DEFAULT', 'Template Default'), ('TEMPLATE_GROUP', 'Template Group Auto-Assign'), ('MANUAL', 'Manual Assignment'), ('DELEGATION', 'Delegated'), ('ESCALATION', 'Escalation')], default='MANUAL', max_length=20)),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('notified_at', models.DateTimeField(blank=True, help_text='When approver was notified of this assignment', null=True)),
                ('reminder_count', models.PositiveIntegerField(default=0, help_text='Number of reminder notifications sent')),
                ('last_reminder_at', models.DateTimeField(blank=True, null=True)),
                ('approval_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approver_assignments', to='Tracker.approvalrequest')),
                ('delegated_from', models.ForeignKey(blank=True, help_text='Original assignment if this was delegated', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delegations', to='Tracker.approverassignment')),
                ('assigned_by', models.ForeignKey(blank=True, help_text='User who made this assignment (null for auto-assignments)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approver_assignments_made', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approval_assignments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'tracker_approver_assignment',
                'ordering': ['sequence_order', 'assigned_at'],
            },
        ),
        migrations.AddField(
            model_name='approvaltemplate',
            name='default_approvers',
            field=models.ManyToManyField(blank=True, related_name='default_approval_templates', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='approvaltemplate',
            name='escalate_to',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='template_escalations', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='ApprovalResponse',
            fields=[
                ('id', models.UUIDField(default=uuid_utils.compat.uuid7, editable=False, primary_key=True, serialize=False)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External system identifier for integration sync', max_length=255, null=True)),
                ('archived', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, editable=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('decision', models.CharField(choices=[('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('DELEGATED', 'Delegated')], max_length=20)),
                ('decision_date', models.DateTimeField(auto_now_add=True)),
                ('comments', models.TextField(blank=True, null=True)),
                ('signature_data', models.TextField(blank=True, help_text='Base64 encoded signature image (PNG)', null=True)),
                ('signature_meaning', models.CharField(blank=True, help_text="e.g., 'I approve as QA Manager'", max_length=200, null=True)),
                ('verified_at', models.DateTimeField(blank=True, help_text='When identity verification succeeded', null=True)),
                ('verification_method', models.CharField(choices=[('PASSWORD', 'Password'), ('SSO', 'SSO'), ('NONE', 'None')], default='NONE', max_length=20)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('self_approved', models.BooleanField(default=False, help_text='True if requester approved their own request')),
                ('approval_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='responses', to='Tracker.approvalrequest')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='Tracker.approvalresponse')),
                ('tenant', models.ForeignKey(blank=True, help_text='Tenant this record belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, to='Tracker.tenant')),
                ('approver', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approval_responses', to=settings.AUTH_USER_MODEL)),
                ('delegated_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delegated_approvals', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Approval Response',
                'verbose_name_plural': 'Approval Responses',
                'ordering': ['-decision_date'],
            },
        ),
        migrations.AddField(
            model_name='approvalrequest',
            name='approvers',
            field=models.ManyToManyField(blank=True, related_name='approval_requests_assigned', through='Tracker.ApproverAssignment', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='approvalrequest',
            name='escalate_to',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='escalated_approvals', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='approvalrequest',
            name='requested_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='approval_requests_made', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='DocChunk',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('embedding', pgvector.django.vector.VectorField(dimensions=768)),
                ('preview_text', models.TextField(blank=True)),
                ('full_text', models.TextField(blank=True)),
                ('span_meta', models.JSONField(blank=True, default=dict)),
                ('doc', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chunks', to='Tracker.documents')),
            ],
            options={
                'db_table': 'doc_chunks',
                'indexes': [models.Index(fields=['doc'], name='doc_chunks_doc_id_0eb459_idx')],
            },
        ),
        migrations.AlterUniqueTogether(
            name='stepmeasurementrequirement',
            unique_together={('step', 'measurement')},
        ),
        migrations.CreateModel(
            name='StepEdge',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('edge_type', models.CharField(choices=[('default', 'Default/Pass'), ('alternate', 'Alternate/Fail'), ('escalation', 'Escalation')], default='default', max_length=20)),
                ('condition_operator', models.CharField(blank=True, choices=[('gte', '>= (greater or equal)'), ('lte', '<= (less or equal)'), ('eq', '= (equal)')], max_length=10)),
                ('condition_value', models.DecimalField(blank=True, decimal_places=4, help_text='Threshold value for measurement-based routing', max_digits=10, null=True)),
                ('condition_measurement', models.ForeignKey(blank=True, help_text='Optional: measurement that triggers this edge', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='condition_edges', to='Tracker.measurementdefinition')),
                ('process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='step_edges', to='Tracker.processes')),
                ('from_step', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='outgoing_edges', to='Tracker.steps')),
                ('to_step', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='incoming_edges', to='Tracker.steps')),
            ],
            options={
                'ordering': ['process', 'from_step', 'edge_type'],
                'unique_together': {('process', 'from_step', 'to_step', 'edge_type')},
            },
        ),
        migrations.CreateModel(
            name='ProcessStep',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('order', models.IntegerField(help_text='Position of this step within the process flow')),
                ('is_entry_point', models.BooleanField(default=False, help_text='If True, this is the starting step for new parts')),
                ('process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_steps', to='Tracker.processes')),
                ('step', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_memberships', to='Tracker.steps')),
            ],
            options={
                'ordering': ['process', 'order'],
                'unique_together': {('process', 'order'), ('process', 'step')},
            },
        ),
        migrations.AddConstraint(
            model_name='shift',
            constraint=models.UniqueConstraint(fields=('tenant', 'code'), name='shift_tenant_code_uniq'),
        ),
        migrations.AddIndex(
            model_name='samplingauditlog',
            index=models.Index(fields=['part', 'timestamp'], name='Tracker_sam_part_id_68cd18_idx'),
        ),
        migrations.AddIndex(
            model_name='samplingauditlog',
            index=models.Index(fields=['rule', 'sampling_decision'], name='Tracker_sam_rule_id_d942d7_idx'),
        ),
        migrations.AddIndex(
            model_name='qualityerrorslist',
            index=models.Index(fields=['tenant', 'created_at'], name='Tracker_qua_tenant__bc8ef2_idx'),
        ),
        migrations.AddIndex(
            model_name='measurementdefinition',
            index=models.Index(fields=['tenant', 'created_at'], name='Tracker_mea_tenant__25b0e3_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='facility',
            unique_together={('tenant', 'code')},
        ),
        migrations.AddIndex(
            model_name='externalapiorderidentifier',
            index=models.Index(fields=['pipeline_id', 'display_order'], name='Tracker_ext_pipelin_ac98a5_idx'),
        ),
        migrations.AddIndex(
            model_name='externalapiorderidentifier',
            index=models.Index(fields=['API_id'], name='Tracker_ext_API_id_2dbdb3_idx'),
        ),
        migrations.AddConstraint(
            model_name='externalapiorderidentifier',
            constraint=models.UniqueConstraint(fields=('tenant', 'stage_name'), name='externalapiorderid_tenant_stage_uniq'),
        ),
        migrations.AddConstraint(
            model_name='documenttype',
            constraint=models.UniqueConstraint(fields=('tenant', 'name'), name='documenttype_tenant_name_uniq'),
        ),
        migrations.AddConstraint(
            model_name='documenttype',
            constraint=models.UniqueConstraint(fields=('tenant', 'code'), name='documenttype_tenant_code_uniq'),
        ),
        migrations.AlterUniqueTogether(
            name='disassemblybomline',
            unique_together={('core_type', 'component_type')},
        ),
        migrations.AlterUniqueTogether(
            name='tenantgroup',
            unique_together={('tenant', 'name')},
        ),
        migrations.AddConstraint(
            model_name='trainingrequirement',
            constraint=models.UniqueConstraint(condition=models.Q(('step__isnull', False)), fields=('training_type', 'step'), name='unique_training_per_step'),
        ),
        migrations.AddConstraint(
            model_name='trainingrequirement',
            constraint=models.UniqueConstraint(condition=models.Q(('process__isnull', False)), fields=('training_type', 'process'), name='unique_training_per_process'),
        ),
        migrations.AddConstraint(
            model_name='trainingrequirement',
            constraint=models.UniqueConstraint(condition=models.Q(('equipment_type__isnull', False)), fields=('training_type', 'equipment_type'), name='unique_training_per_equipment_type'),
        ),
        migrations.AddConstraint(
            model_name='workcenter',
            constraint=models.UniqueConstraint(fields=('tenant', 'code'), name='workcenter_tenant_code_uniq'),
        ),
        migrations.AddIndex(
            model_name='workorder',
            index=models.Index(fields=['workorder_status', 'created_at'], name='workorder_status_created_idx'),
        ),
        migrations.AddIndex(
            model_name='workorder',
            index=models.Index(fields=['related_order', 'workorder_status'], name='workorder_order_status_idx'),
        ),
        migrations.AddIndex(
            model_name='workorder',
            index=models.Index(fields=['process', 'workorder_status'], name='workorder_process_status_idx'),
        ),
        migrations.AddIndex(
            model_name='scheduleslot',
            index=models.Index(fields=['work_center', 'scheduled_date'], name='Tracker_sch_work_ce_221248_idx'),
        ),
        migrations.AddIndex(
            model_name='scheduleslot',
            index=models.Index(fields=['work_order', 'status'], name='Tracker_sch_work_or_dcec0c_idx'),
        ),
        migrations.AddConstraint(
            model_name='samplinganalytics',
            constraint=models.UniqueConstraint(fields=('tenant', 'ruleset', 'work_order'), name='samplinganalytics_tenant_uniq'),
        ),
        migrations.AddIndex(
            model_name='parts',
            index=models.Index(fields=['part_status', 'work_order'], name='parts_status_workorder_idx'),
        ),
        migrations.AddIndex(
            model_name='parts',
            index=models.Index(fields=['part_status', 'step'], name='parts_status_step_idx'),
        ),
        migrations.AddIndex(
            model_name='parts',
            index=models.Index(fields=['work_order', 'step'], name='parts_workorder_step_idx'),
        ),
        migrations.AddIndex(
            model_name='parts',
            index=models.Index(fields=['order', 'part_status'], name='parts_order_status_idx'),
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['user', 'group'], name='tracker_use_user_id_7bf7b2_idx'),
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['group', 'facility'], name='tracker_use_group_i_aa5929_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='userrole',
            unique_together={('user', 'group', 'facility', 'company')},
        ),
        migrations.AddIndex(
            model_name='userinvitation',
            index=models.Index(fields=['token'], name='Tracker_use_token_bb3dde_idx'),
        ),
        migrations.AddIndex(
            model_name='userinvitation',
            index=models.Index(fields=['user', '-sent_at'], name='Tracker_use_user_id_b8ff2f_idx'),
        ),
        migrations.AddIndex(
            model_name='timeentry',
            index=models.Index(fields=['user', 'start_time'], name='Tracker_tim_user_id_3c459e_idx'),
        ),
        migrations.AddIndex(
            model_name='timeentry',
            index=models.Index(fields=['work_order', 'entry_type'], name='Tracker_tim_work_or_db6fe6_idx'),
        ),
        migrations.AddIndex(
            model_name='timeentry',
            index=models.Index(fields=['entry_type', 'start_time'], name='Tracker_tim_entry_t_6773ae_idx'),
        ),
        migrations.AddIndex(
            model_name='tenantgroupmembership',
            index=models.Index(fields=['tenant', 'user'], name='Tracker_ten_tenant__3b433a_idx'),
        ),
        migrations.AddIndex(
            model_name='tenantgroupmembership',
            index=models.Index(fields=['user', 'group'], name='Tracker_ten_user_id_97fe93_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='tenantgroupmembership',
            unique_together={('tenant', 'user', 'group')},
        ),
        migrations.AddIndex(
            model_name='stepexecution',
            index=models.Index(fields=['part', 'step'], name='Tracker_ste_part_id_0644fe_idx'),
        ),
        migrations.AddIndex(
            model_name='stepexecution',
            index=models.Index(fields=['status', 'entered_at'], name='Tracker_ste_status_1c294b_idx'),
        ),
        migrations.AddIndex(
            model_name='stepexecution',
            index=models.Index(fields=['assigned_to', 'status'], name='Tracker_ste_assigne_81a578_idx'),
        ),
        migrations.AddIndex(
            model_name='spcbaseline',
            index=models.Index(fields=['measurement_definition', 'status'], name='Tracker_spc_measure_db548c_idx'),
        ),
        migrations.AddIndex(
            model_name='spcbaseline',
            index=models.Index(fields=['measurement_definition', '-frozen_at'], name='Tracker_spc_measure_d88929_idx'),
        ),
        migrations.AddConstraint(
            model_name='samplingtriggerstate',
            constraint=models.UniqueConstraint(fields=('tenant', 'ruleset', 'work_order', 'step'), name='samplingtriggerstate_tenant_uniq'),
        ),
        migrations.AddIndex(
            model_name='samplingruleset',
            index=models.Index(fields=['tenant', 'created_at'], name='Tracker_sam_tenant__c29e6c_idx'),
        ),
        migrations.AddIndex(
            model_name='samplingrule',
            index=models.Index(fields=['tenant', 'created_at'], name='Tracker_sam_tenant__2ba68b_idx'),
        ),
        migrations.AddIndex(
            model_name='quarantinedisposition',
            index=models.Index(fields=['current_state', 'created_at'], name='disposition_state_created_idx'),
        ),
        migrations.AddIndex(
            model_name='quarantinedisposition',
            index=models.Index(fields=['part', 'current_state'], name='disposition_part_state_idx'),
        ),
        migrations.AddConstraint(
            model_name='quarantinedisposition',
            constraint=models.UniqueConstraint(fields=('tenant', 'disposition_number'), name='disposition_tenant_number_uniq'),
        ),
        migrations.AddIndex(
            model_name='qualityreports',
            index=models.Index(fields=['part', 'status'], name='qr_part_status_idx'),
        ),
        migrations.AddIndex(
            model_name='qualityreports',
            index=models.Index(fields=['step', 'created_at'], name='qr_step_created_idx'),
        ),
        migrations.AddIndex(
            model_name='qualityreports',
            index=models.Index(fields=['status', 'created_at'], name='qr_status_created_idx'),
        ),
        migrations.AddConstraint(
            model_name='qualityreports',
            constraint=models.UniqueConstraint(condition=models.Q(('report_number__isnull', False), models.Q(('report_number', ''), _negated=True)), fields=('tenant', 'report_number'), name='qualityreport_tenant_number_uniq'),
        ),
        migrations.AddIndex(
            model_name='qaapproval',
            index=models.Index(fields=['tenant', 'created_at'], name='Tracker_qaa_tenant__2301d6_idx'),
        ),
        migrations.AddIndex(
            model_name='permissionchangelog',
            index=models.Index(fields=['group_name', '-timestamp'], name='Tracker_per_group_n_549550_idx'),
        ),
        migrations.AddIndex(
            model_name='permissionchangelog',
            index=models.Index(fields=['action', '-timestamp'], name='Tracker_per_action_5f97b0_idx'),
        ),
        migrations.AddIndex(
            model_name='permissionchangelog',
            index=models.Index(fields=['tenant', '-timestamp'], name='permlog_tenant_time_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='orderviewer',
            unique_together={('order', 'user')},
        ),
        migrations.AddIndex(
            model_name='orders',
            index=models.Index(fields=['order_status', 'created_at'], name='orders_status_created_idx'),
        ),
        migrations.AddIndex(
            model_name='orders',
            index=models.Index(fields=['customer', 'order_status'], name='orders_customer_status_idx'),
        ),
        migrations.AddIndex(
            model_name='orders',
            index=models.Index(fields=['company', 'order_status'], name='orders_company_status_idx'),
        ),
        migrations.AddConstraint(
            model_name='orders',
            constraint=models.UniqueConstraint(condition=models.Q(('order_number__isnull', False), models.Q(('order_number', ''), _negated=True)), fields=('tenant', 'order_number'), name='orders_tenant_number_uniq'),
        ),
        migrations.AddConstraint(
            model_name='orders',
            constraint=models.UniqueConstraint(condition=models.Q(('hubspot_deal_id__isnull', False), models.Q(('hubspot_deal_id', ''), _negated=True)), fields=('tenant', 'hubspot_deal_id'), name='orders_tenant_hubspot_deal_uniq'),
        ),
        migrations.AddIndex(
            model_name='notificationtask',
            index=models.Index(fields=['recipient', 'notification_type', 'channel_type'], name='Tracker_not_recipie_4988e7_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationtask',
            index=models.Index(fields=['status', 'next_send_at'], name='Tracker_not_status_98cfb1_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationtask',
            index=models.Index(fields=['related_content_type', 'related_object_id'], name='Tracker_not_related_eeda67_idx'),
        ),
        migrations.AddIndex(
            model_name='measurementresult',
            index=models.Index(fields=['tenant', 'created_at'], name='Tracker_mea_tenant__0d6bbd_idx'),
        ),
        migrations.AddIndex(
            model_name='materialusage',
            index=models.Index(fields=['part'], name='Tracker_mat_part_id_b91ee1_idx'),
        ),
        migrations.AddIndex(
            model_name='materialusage',
            index=models.Index(fields=['lot'], name='Tracker_mat_lot_id_514590_idx'),
        ),
        migrations.AddIndex(
            model_name='materialusage',
            index=models.Index(fields=['harvested_component'], name='Tracker_mat_harvest_39bf3e_idx'),
        ),
        migrations.AddConstraint(
            model_name='materialusage',
            constraint=models.CheckConstraint(condition=models.Q(models.Q(('lot__isnull', False), ('harvested_component__isnull', True)), models.Q(('lot__isnull', True), ('harvested_component__isnull', False)), _connector='OR'), name='material_usage_source_xor'),
        ),
        migrations.AddIndex(
            model_name='materiallot',
            index=models.Index(fields=['lot_number'], name='Tracker_mat_lot_num_ac9614_idx'),
        ),
        migrations.AddIndex(
            model_name='materiallot',
            index=models.Index(fields=['supplier', 'received_date'], name='Tracker_mat_supplie_bb1068_idx'),
        ),
        migrations.AddIndex(
            model_name='materiallot',
            index=models.Index(fields=['status', 'expiration_date'], name='Tracker_mat_status_099572_idx'),
        ),
        migrations.AddConstraint(
            model_name='materiallot',
            constraint=models.UniqueConstraint(fields=('tenant', 'lot_number'), name='materiallot_tenant_lotnumber_uniq'),
        ),
        migrations.AddIndex(
            model_name='heatmapannotations',
            index=models.Index(fields=['model', 'part'], name='Tracker_hea_model_i_36bdc5_idx'),
        ),
        migrations.AddIndex(
            model_name='harvestedcomponent',
            index=models.Index(fields=['core', 'component_type'], name='Tracker_har_core_id_8bc699_idx'),
        ),
        migrations.AddIndex(
            model_name='harvestedcomponent',
            index=models.Index(fields=['condition_grade', 'is_scrapped'], name='Tracker_har_conditi_6cde1f_idx'),
        ),
        migrations.AddIndex(
            model_name='harvestedcomponent',
            index=models.Index(fields=['component_type', 'is_scrapped'], name='Tracker_har_compone_fdb089_idx'),
        ),
        migrations.AddConstraint(
            model_name='groupapproverassignment',
            constraint=models.UniqueConstraint(fields=('approval_request', 'group'), name='groupapproverassignment_request_group_uniq'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['report_type', 'generated_at'], name='Tracker_gen_report__1a38f1_idx'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['generated_by', 'generated_at'], name='Tracker_gen_generat_ecc61b_idx'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['status'], name='Tracker_gen_status_b4f340_idx'),
        ),
        migrations.AddIndex(
            model_name='downtimeevent',
            index=models.Index(fields=['equipment', 'start_time'], name='Tracker_dow_equipme_394de5_idx'),
        ),
        migrations.AddIndex(
            model_name='downtimeevent',
            index=models.Index(fields=['work_center', 'start_time'], name='Tracker_dow_work_ce_3b5dc0_idx'),
        ),
        migrations.AddIndex(
            model_name='downtimeevent',
            index=models.Index(fields=['category', 'start_time'], name='Tracker_dow_categor_03667d_idx'),
        ),
        migrations.AddIndex(
            model_name='documents',
            index=models.Index(fields=['content_type', 'object_id'], name='documents_content_object_idx'),
        ),
        migrations.AddIndex(
            model_name='documents',
            index=models.Index(fields=['status', 'created_at'], name='documents_status_created_idx'),
        ),
        migrations.AddIndex(
            model_name='documents',
            index=models.Index(fields=['review_date'], name='documents_review_date_idx'),
        ),
        migrations.AddIndex(
            model_name='documents',
            index=models.Index(fields=['retention_until'], name='documents_retention_idx'),
        ),
        migrations.AddIndex(
            model_name='core',
            index=models.Index(fields=['core_number'], name='Tracker_cor_core_nu_6c4d4c_idx'),
        ),
        migrations.AddIndex(
            model_name='core',
            index=models.Index(fields=['status', 'received_date'], name='Tracker_cor_status_c58958_idx'),
        ),
        migrations.AddIndex(
            model_name='core',
            index=models.Index(fields=['customer', 'received_date'], name='Tracker_cor_custome_f821d9_idx'),
        ),
        migrations.AddIndex(
            model_name='core',
            index=models.Index(fields=['core_type', 'status'], name='Tracker_cor_core_ty_d56e4f_idx'),
        ),
        migrations.AddConstraint(
            model_name='core',
            constraint=models.UniqueConstraint(fields=('tenant', 'core_number'), name='core_tenant_number_uniq'),
        ),
        migrations.AddIndex(
            model_name='chatsession',
            index=models.Index(fields=['user', '-updated_at'], name='chat_sessio_user_id_b84598_idx'),
        ),
        migrations.AddIndex(
            model_name='chatsession',
            index=models.Index(fields=['langgraph_thread_id'], name='chat_sessio_langgra_2087cd_idx'),
        ),
        migrations.AddIndex(
            model_name='chatsession',
            index=models.Index(fields=['tenant', '-updated_at'], name='chat_tenant_updated_idx'),
        ),
        migrations.AddConstraint(
            model_name='chatsession',
            constraint=models.UniqueConstraint(fields=('tenant', 'langgraph_thread_id'), name='chatsession_tenant_thread_uniq'),
        ),
        migrations.AddIndex(
            model_name='capatasks',
            index=models.Index(fields=['capa', 'status'], name='Tracker_cap_capa_id_1e372e_idx'),
        ),
        migrations.AddConstraint(
            model_name='capatasks',
            constraint=models.UniqueConstraint(fields=('tenant', 'task_number'), name='capatask_tenant_number_uniq'),
        ),
        migrations.AlterUniqueTogether(
            name='capataskassignee',
            unique_together={('task', 'user')},
        ),
        migrations.AddIndex(
            model_name='capa',
            index=models.Index(fields=['capa_number'], name='Tracker_cap_capa_nu_de4f74_idx'),
        ),
        migrations.AddIndex(
            model_name='capa',
            index=models.Index(fields=['status', 'due_date'], name='Tracker_cap_status_1f6dc3_idx'),
        ),
        migrations.AddIndex(
            model_name='capa',
            index=models.Index(fields=['severity', 'status'], name='Tracker_cap_severit_1c1543_idx'),
        ),
        migrations.AddConstraint(
            model_name='capa',
            constraint=models.UniqueConstraint(fields=('tenant', 'capa_number'), name='capa_tenant_number_uniq'),
        ),
        migrations.AddConstraint(
            model_name='bom',
            constraint=models.UniqueConstraint(fields=('tenant', 'part_type', 'revision', 'bom_type'), name='bom_tenant_parttype_rev_type_uniq'),
        ),
        migrations.AddIndex(
            model_name='assemblyusage',
            index=models.Index(fields=['assembly'], name='Tracker_ass_assembl_ea1277_idx'),
        ),
        migrations.AddIndex(
            model_name='assemblyusage',
            index=models.Index(fields=['component'], name='Tracker_ass_compone_9dbaa8_idx'),
        ),
        migrations.AddIndex(
            model_name='assemblyusage',
            index=models.Index(fields=['removed_at'], name='Tracker_ass_removed_0db8e9_idx'),
        ),
        migrations.AddConstraint(
            model_name='archivereason',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('tenant', 'content_type', 'object_id'), name='archivereason_tenant_content_object_unique'),
        ),
        migrations.AddIndex(
            model_name='approverassignment',
            index=models.Index(fields=['approval_request', 'is_required'], name='tracker_app_approva_991b6c_idx'),
        ),
        migrations.AddIndex(
            model_name='approverassignment',
            index=models.Index(fields=['user', 'assigned_at'], name='tracker_app_user_id_816372_idx'),
        ),
        migrations.AddConstraint(
            model_name='approverassignment',
            constraint=models.UniqueConstraint(fields=('approval_request', 'user'), name='approverassignment_request_user_uniq'),
        ),
        migrations.AddConstraint(
            model_name='approvaltemplate',
            constraint=models.UniqueConstraint(fields=('tenant', 'template_name'), name='approvaltemplate_tenant_name_uniq'),
        ),
        migrations.AddConstraint(
            model_name='approvaltemplate',
            constraint=models.UniqueConstraint(fields=('tenant', 'approval_type'), name='approvaltemplate_tenant_type_uniq'),
        ),
        migrations.AlterUniqueTogether(
            name='approvalresponse',
            unique_together={('approval_request', 'approver')},
        ),
        migrations.AddIndex(
            model_name='approvalrequest',
            index=models.Index(fields=['status', 'due_date'], name='approvalrequest_status_due_idx'),
        ),
        migrations.AddConstraint(
            model_name='approvalrequest',
            constraint=models.UniqueConstraint(fields=('tenant', 'approval_number'), name='approvalrequest_tenant_number_uniq'),
        ),
    ]
