# NIST SP 800-171

Protecting Controlled Unclassified Information (CUI) in nonfederal systems.

## Overview

| Framework | Version | Readiness |
|-----------|---------|-----------|
| NIST SP 800-171 | Rev 2 | **100%** |

NIST 800-171 provides security requirements for protecting CUI when processed, stored, or transmitted by nonfederal organizations. It contains 110 security requirements across 14 families.

> **Note**: Percentage reflects application-level controls. Infrastructure controls (encryption, network security) and organizational processes (compliance reviews, user lifecycle management) are customer responsibilities.

## Applicability

NIST 800-171 applies when you:
- Handle Controlled Unclassified Information (CUI)
- Contract with federal agencies (especially DoD)
- Are in the defense industrial base supply chain
- Process data subject to DFARS 252.204-7012

## Control Families Summary

| Family | ID | Controls | Implemented | Partial | N/A |
|--------|-----|----------|-------------|---------|-----|
| Access Control | 3.1 | 22 | 14 | 1 | 7 |
| Awareness and Training | 3.2 | 3 | 0 | 0 | 3 |
| Audit and Accountability | 3.3 | 9 | 5 | 3 | 1 |
| Configuration Management | 3.4 | 9 | 5 | 1 | 3 |
| Identification and Authentication | 3.5 | 11 | 6 | 1 | 4 |
| Incident Response | 3.6 | 3 | 0 | 1 | 2 |
| Maintenance | 3.7 | 6 | 0 | 0 | 6 |
| Media Protection | 3.8 | 9 | 5 | 0 | 4 |
| Personnel Security | 3.9 | 2 | 1 | 0 | 1 |
| Physical Protection | 3.10 | 6 | 0 | 0 | 6 |
| Risk Assessment | 3.11 | 3 | 0 | 0 | 3 |
| Security Assessment | 3.12 | 4 | 0 | 1 | 3 |
| System and Communications Protection | 3.13 | 16 | 4 | 0 | 12 |
| System and Information Integrity | 3.14 | 7 | 1 | 0 | 6 |

## 3.1 Access Control

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.1.1 | Limit system access to authorized users | `TenantMiddleware` enforces authentication; `DEFAULT_PERMISSION_CLASSES = [IsAuthenticated, DjangoModelPermissions]` |
| 3.1.2 | Limit access to authorized functions | 9 role groups with granular permissions; `TenantScopedMixin` enforces tenant filtering |
| 3.1.3 | Control the flow of CUI | Documents model with `classification` field (PUBLIC, INTERNAL, CONFIDENTIAL, RESTRICTED, SECRET); `user_can_access()` method |
| 3.1.4 | Separate duties of individuals | 9 distinct role groups; `self_verified` field prevents self-verification |
| 3.1.5 | Employ principle of least privilege | Customer role has minimal permissions; `perform_create()` auto-assigns tenant |
| 3.1.6 | Use non-privileged accounts | Production_Operator has minimal permissions; non-staff restrictions |
| 3.1.7 | Prevent non-privileged users from executing privileged functions | Permission checks before approval; `review_rca` permission required |
| 3.1.11 | Terminate session after defined conditions | Django session framework handles termination |
| 3.1.12 | Monitor and control remote access | ApprovalResponse captures `ip_address`; django-auditlog tracks changes |
| 3.1.15 | Authorize remote execution | `SessionAuthentication` + `TokenAuthentication` |
| 3.1.22 | Control CUI posted on public systems | Document classification prevents public disclosure |

### Organizational Process Controls

These controls are implemented at the application level. The organizational processes to use them are customer responsibility:

| Control | Requirement | Application Provides | Organization Provides |
|---------|-------------|---------------------|----------------------|
| 3.1.20 | Verify and control external system connections | Integration logging (HubSpot sync logs, API audit trail) | External system inventory in SSP documentation |

### Configuration-Dependent Controls

| Control | Requirement | How to Configure |
|---------|-------------|------------------|
| 3.1.8 | Limit unsuccessful login attempts | django-allauth settings or customer IdP |
| 3.1.9 | Provide privacy and security notices | Frontend login page configuration |
| 3.1.10 | Use session lock after inactivity | `SESSION_COOKIE_AGE` in settings.py |

### Infrastructure Controls (N/A)

3.1.13, 3.1.14, 3.1.16-19, 3.1.21 - Network, wireless, mobile device controls

## 3.3 Audit and Accountability

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.3.1 | Create audit records | `AuditlogMiddleware` + `AUDITLOG_INCLUDE_ALL_MODELS=True`; PermissionChangeLog model |
| 3.3.2 | Ensure actions traced to individuals | ApprovalResponse captures `ip_address`, `self_approved`; tenant linked to User |
| 3.3.8 | Protect audit information | PostgreSQL triggers block UPDATE/DELETE on audit tables (`setup_audit_triggers` command) |
| 3.3.9 | Limit audit management to privileged users | Only Admin group has full audit access |

### Organizational Process Controls

These controls are implemented at the application level. The organizational processes to use them are customer responsibility:

| Control | Requirement | Application Provides | Organization Provides |
|---------|-------------|---------------------|----------------------|
| 3.3.3 | Review and update logged events | Audit logs via API, admin interface | Compliance review procedures |
| 3.3.5 | Correlate audit review and reporting | Audit data accessible via API | SIEM integration, log forwarding |
| 3.3.6 | Provide audit reduction and report generation | Excel export, API filtering | Report formatting, templates |

## 3.4 Configuration Management

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.4.1 | Establish baseline configurations | SecureModel `create_new_version()`, `get_version_history()`; SPCBaseline with `frozen_by`, `frozen_at` |
| 3.4.3 | Track, review, approve changes | ApprovalRequest workflow; Process status (DRAFT→PENDING_APPROVAL→APPROVED→DEPRECATED) |
| 3.4.5 | Define access restrictions | Exempt paths in middleware; TenantScopedMixin restricts access |
| 3.4.6 | Employ least functionality | Customer role view-only; explicit permission checks |
| 3.4.8 | Apply deny-by-exception policy | DEFAULT_PERMISSION_CLASSES requires authentication |

### Organizational Process Controls

| Control | Requirement | Application Provides | Organization Provides |
|---------|-------------|---------------------|----------------------|
| 3.4.4 | Analyze security impact of changes | `change_justification` field, approval workflow | Security impact review procedures |

## 3.5 Identification and Authentication

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.5.1 | Identify users, processes, devices | User model with UUID, tenant, user_type; Token authentication |
| 3.5.2 | Authenticate users, processes, devices | SessionAuthentication + TokenAuthentication; django-allauth OAuth/SSO |
| 3.5.4 | Employ replay-resistant authentication | Django CSRF tokens; server-side session validation |
| 3.5.5 | Prevent identifier reuse | UUID v7 primary keys; unique username constraint |
| 3.5.10 | Store and transmit only protected passwords | Django PBKDF2 hashing (FIPS-approved) |
| 3.5.11 | Obscure feedback of authentication info | Generic error messages |

### Organizational Process Controls

| Control | Requirement | Application Provides | Organization Provides |
|---------|-------------|---------------------|----------------------|
| 3.5.6 | Disable identifiers after inactivity | `is_active` field, bulk activate/deactivate actions | User lifecycle management via IdP/HR |

## 3.8 Media Protection

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.8.2 | Limit access to CUI on media | Document access control; `get_access_info()` permission check |
| 3.8.3 | Sanitize media before disposal | Soft delete with `archived`/`deleted_at`; ArchiveReason tracking |
| 3.8.4 | Mark media with CUI markings | ClassificationLevel enum (PUBLIC→SECRET); Document `classification` field |
| 3.8.5 | Control access to CUI media | Separate permissions: `view_confidential_documents`, `view_restricted_documents`, `view_secret_documents` |

## 3.13 System and Communications Protection

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.13.2 | Employ architectural designs | Multi-tenant with Row-Level Security on 97 tables |
| 3.13.3 | Separate user from system functionality | Django admin separate from user interface |
| 3.13.4 | Prevent unauthorized data transfer | `perform_update()` prevents tenant changes; RLS policies |
| 3.13.15 | Protect authenticity of communications | Django CSRF protection; CORS validation |

## 3.14 System and Information Integrity

### Implemented Controls

| Control | Requirement | Implementation |
|---------|-------------|----------------|
| 3.14.7 | Identify unauthorized use | django-auditlog tracks all actions; PermissionChangeLog |

## Shared Responsibility Summary

The application provides data and controls. Organizational processes use them:

| Category | Application Provides | Organization Provides |
|----------|---------------------|----------------------|
| **User Management** | `is_active` field, bulk actions | User lifecycle procedures (IdP/HR) |
| **Audit Data** | Immutable logs, API access, Excel export | Review procedures, SIEM forwarding |
| **Change Control** | `change_justification`, approval workflow | Security impact review process |
| **External Systems** | Integration logging | SSP documentation of connections |

No application-level gaps remain for NIST 800-171 compliance.

## SSP (System Security Plan) Evidence

For your System Security Plan, reference these files:

| Control Family | Evidence Files |
|----------------|----------------|
| Access Control | `Tracker/permissions.py`, `Tracker/middleware.py`, `Tracker/viewsets/base.py` |
| Audit | `settings.py`, `Tracker/models/core.py`, `Tracker/management/commands/setup_audit_triggers.py` |
| Configuration | `Tracker/models/core.py` (SecureModel), `Tracker/models/spc.py` |
| Identification | `Tracker/models/core.py` (User), `settings.py` (AUTH config) |
| Media Protection | `Tracker/models/core.py` (Documents, ClassificationLevel) |
| System Protection | `Tracker/migrations/0003_enable_rls.py` |

## Related Documentation

- [CMMC Level 2](cmmc.md) - DoD certification requirements
- [Export Controls (ITAR)](export-controls.md) - Defense article handling
- [Audit Trails](audit-trails.md) - Detailed logging information
- [Compliance Overview](overview.md) - All frameworks summary
